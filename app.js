(()=>{"use strict";var e={3165:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(3685)),c=i(n(4470)),u=n(3640),l=n(4310),d=n(8222),f=n(3952),p=n(5018),h=i(n(3018));l.initVersionManager();const m=l.getVersion();console.log(`\n______  _______________________  ___                                         \n___   |/  /_  ____/_  ___/__   |/  /_____ _____________ _______ _____________\n__  /|_/ /_  /    _____ \\__  /|_/ /_  __ \`/_  __ \\  __ \`/_  __ \`/  _ \\_  ___/\n_  /  / / / /___  ____/ /_  /  / / / /_/ /_  / / / /_/ /_  /_/ //  __/  /    \n/_/  /_/  \\____/  /____/ /_/  /_/  \\__,_/ /_/ /_/\\__,_/ _\\__, / \\___//_/     \n                                                        /____/               \n________                                                                     \n___  __ \\_____ ____________ ________________                                 \n__  / / /  __ \`/  _ \\_  __ \`__ \\  __ \\_  __ \\                                \n_  /_/ // /_/ //  __/  / / / / / /_/ /  / / /                                \n/_____/ \\__,_/ \\___//_/ /_/ /_/\\____//_/ /_/                                 \n                                                                             \n\n + Copyright 2022 MCSManager Dev <https://github.com/MCSManager>\n + Version ${m}\n`),d.globalConfiguration.load();const g=d.globalConfiguration.config;if(c.default.existsSync(p.LOCAL_PRESET_LANG_PATH))u.i18next.changeLanguage(c.default.readFileSync(p.LOCAL_PRESET_LANG_PATH,"utf-8"));else{const e=g.language||"en_us";h.default.info(`LANGUAGE: ${e}`),u.i18next.changeLanguage(e)}h.default.info(u.$t("app.welcome"));const _=a(n(1018)),y=a(n(9815)),w=a(n(8742)),k=i(n(9597)),P=n(559);n(6399),n(6674),P.initDependent();const v=y.initKoa();v.on("error",(e=>{}));const E=o.default.createServer(v.callback());E.listen(g.port,g.ip);const S=new f.Server(E,{serveClient:!1,pingInterval:5e3,pingTimeout:5e3,cookie:!1,path:"/socket.io",cors:{origin:"*",methods:["GET","POST","PUT","DELETE"]}});try{k.default.loadInstances(),h.default.info(u.$t("app.instanceLoad",{n:k.default.instances.size}))}catch(e){h.default.error(u.$t("app.instanceLoadError"),e),process.exit(-1)}async function T(){try{console.log(""),h.default.warn("Program received EXIT command."),await k.default.exit(),h.default.info("Exit.")}catch(e){h.default.error("ERROR:",e)}finally{process.exit(0)}}S.on("connection",(e=>{h.default.info(u.$t("app.sessionConnect",{ip:e.handshake.address,uuid:e.id})),w.addGlobalSocket(e),_.navigation(e),e.on("disconnect",(()=>{w.delGlobalSocket(e);for(const t of e.eventNames())e.removeAllListeners(t);h.default.info(u.$t("app.sessionDisconnect",{ip:e.handshake.address,uuid:e.id}))}))})),process.on("uncaughtException",(function(e){h.default.error("Error: UncaughtException:",e)})),process.on("unhandledRejection",((e,t)=>{h.default.error("Error: UnhandledRejection:",e,t)})),h.default.info("----------------------------"),h.default.info(u.$t("app.started")),h.default.info(u.$t("app.doc")),h.default.info(u.$t("app.addr",{port:g.port})),h.default.info(u.$t("app.configPathTip",{path:""})),h.default.info(u.$t("app.password",{key:g.key})),h.default.info(u.$t("app.passwordTip")),h.default.info(u.$t("app.exitTip")),h.default.info("----------------------------"),console.log(""),["SIGTERM","SIGINT","SIGQUIT"].forEach((function(e){process.on(e,(()=>{h.default.warn(`${e} close process signal detected.`),T()}))})),process.stdin.on("data",(e=>{"exit"===e.toString().replace("\n","").replace("\r","").trim().toLowerCase()&&T()}))},5046:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decompress=t.compress=void 0,n(3640);const o=i(n(4470)),c=i(n(1017)),u=(a(n(7416)),i(n(2081)),i(n(2037))),l=i(n(5500)),d=i(n(7601)),f=n(5927),p=n(5018);function h(){return o.default.existsSync(p.PTY_PATH)}u.default.platform(),t.compress=async function(e,t,n){return h()?async function(e,t,n="utf-8"){let s=["-coder",n,"-m","zip"];return s=s.concat(e),s.push(t),console.log("GO Unzip Params",s),await new f.processWrapper(p.PTY_PATH,s,".",1800).start()}(t,e,n):await function(e,t,n="utf-8"){return new Promise(((n,s)=>{const r=o.default.createWriteStream(e),a=l.default("zip",{zlib:{level:9}});t.forEach((e=>{var t;const n=c.default.normalize(c.default.basename(e));o.default.existsSync(e)&&((null===(t=o.default.statSync(e))||void 0===t?void 0:t.isDirectory())?a.directory(e,n):a.file(e,{name:n}))})),r.on("close",(function(){n(!0)})),a.on("warning",(function(e){s(e)})),a.on("error",(function(e){s(e)})),a.pipe(r),a.finalize()}))}(e,t,n)},t.decompress=async function(e,t,n){return h()?await async function(e,t,n="utf-8"){return console.log("GO Zip Params",e,t,n),await new f.processWrapper(p.PTY_PATH,["-coder",n,"-m","unzip",e,t],".",1800).start()}(e,t,n):await function(e,t,n="utf-8"){return new Promise((async(s,r)=>{const a=new d.default.async({file:e,nameEncoding:n});o.default.existsSync(t)||o.default.mkdirsSync(t);try{return await a.extract(null,t),s(!0)}catch(e){r(e)}a.close().then((()=>{})).catch((()=>{}))}))}(e,t,n)}},6473:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{static set(e,t){n.map.set(e,t)}static get(e,t){return n.map.has(e)?n.map.get(e):t}static del(e){return n.map.delete(e)}}t.default=n,n.map=new Map},2764:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.listenMap=new Map}requestForward(e,t){if(this.listenMap.has(t)){const n=this.listenMap.get(t);for(const t of n)if(t.id===e.id)throw new Error(`此 Socket ${e.id} 已经存在于指定实例监听表中`);n.push(e)}else this.listenMap.set(t,[e])}cannelForward(e,t){if(!this.listenMap.has(t))throw new Error(`指定 ${t} 并不存在于监听表中`);const n=this.listenMap.get(t);n.forEach(((t,s)=>{t.id===e.id&&n.splice(s,1)}))}forward(e,t){this.listenMap.get(e).forEach((e=>{e&&e.connected&&e.emit("instance/stdout",t)}))}forwardViaCallback(e,t){this.listenMap.has(e)&&this.listenMap.get(e).forEach((e=>{e&&e.connected&&t(e)}))}hasListenInstance(e){return this.listenMap.has(e)&&this.listenMap.get(e).length>0}}},1787:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1808));t.default=class{constructor(e,t){this.port=e,this.host=t,this.status={online:null,version:null,motd:null,current_players:null,max_players:null,latency:null}}getStatus(){return new Promise(((e,t)=>{var n=(new Date).getTime();const s=r.default.connect(this.port,this.host,(()=>{this.status.latency=Math.round((new Date).getTime()-n);let e=Buffer.from([254,1]);s.write(e)}));s.on("data",(t=>{var n=t.toString().split("\0\0");this.status={host:this.host,port:this.port,status:!0,version:n[2].replace(/\u0000/g,""),motd:n[3].replace(/\u0000/g,""),current_players:n[4].replace(/\u0000/g,""),max_players:n[5].replace(/\u0000/g,""),latency:this.status.latency},function(e){let t=e.replace(/\u0000/g,"");Buffer.from(t)}(n[3]),s.end(),e(this.status)})),s.on("end",(()=>{})),s.on("error",(e=>{t(e)}))}))}async asyncStatus(){return await this.getStatus()}}},5927:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.killProcess=t.processWrapper=void 0;const r=n(3640),a=n(2081),i=s(n(2037)),o=s(n(2081)),c=s(n(1017)),u=s(n(1239)),l=s(n(5135));class d extends u.default{constructor(e,t,n,s=null,r="utf-8",a={}){super(),this.file=e,this.args=t,this.cwd=n,this.timeout=s,this.code=r,this.option=a}start(){return new Promise(((e,t)=>{let n=null;const s=o.default.spawn(this.file,this.args,{stdio:"pipe",windowsHide:!0,cwd:c.default.normalize(this.cwd),...this.option});if(this.process=s,this.pid=s.pid,this.emit("start",s.pid),!s||!s.pid)return t(!1);s.stdout.on("data",(e=>this.emit("data",l.default.decode(e,this.code)))),s.stderr.on("data",(e=>this.emit("data",l.default.decode(e,this.code)))),s.on("exit",(t=>{try{this.emit("exit",t),this.destroy()}catch(e){}return n&&clearTimeout(n),e(0==t)})),this.timeout&&(n=setTimeout((()=>{f(s.pid,s),t(!1)}),1e3*this.timeout))}))}getPid(){return this.process.pid}write(e){return this.process.stdin.write(l.default.encode(e,this.code))}kill(){f(this.process.pid,this.process)}status(){return null==this.process.exitCode}exitCode(){return this.process.exitCode}async destroy(){var e,t,n,s,r;try{for(const e of this.eventNames())this.removeAllListeners(e);if(this.process.stdout)for(const e of this.process.stdout.eventNames())this.process.stdout.removeAllListeners(e);if(this.process.stderr)for(const e of this.process.stderr.eventNames())this.process.stderr.removeAllListeners(e);if(this.process)for(const e of this.process.eventNames())this.process.removeAllListeners(e);null===(t=null===(e=this.process)||void 0===e?void 0:e.stdout)||void 0===t||t.destroy(),null===(s=null===(n=this.process)||void 0===n?void 0:n.stderr)||void 0===s||s.destroy(),null===(null===(r=this.process)||void 0===r?void 0:r.exitCode)&&(this.process.kill("SIGTERM"),this.process.kill("SIGKILL"))}catch(e){console.log("[ProcessWrapper destroy() Error]",e)}finally{this.process=null}}}function f(e,t,n){try{if("win32"===i.default.platform())return a.execSync(`taskkill /PID ${e} /T /F`),console.log(r.$t("common.killProcess",{pid:e})),!0;if("linux"===i.default.platform())return a.execSync(`kill -s 9 ${e}`),console.log(r.$t("common.killProcess",{pid:e})),!0}catch(e){return n?t.kill(n):t.kill("SIGKILL")}return n?t.kill(n):t.kill("SIGKILL")}t.processWrapper=d,t.killProcess=f},3459:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryWrapper=t.LocalFileSource=t.MySqlSource=t.QueryMapWrapper=void 0,t.QueryMapWrapper=class{constructor(e){this.map=e}select(e){const t=[];return this.map.forEach((n=>{e(n)&&t.push(n)})),t}page(e,t=1,n=10){const s=(t-1)*n,r=s+n;let a=e.length,i=0;for(;a>0;)a-=n,i++;return{page:t,pageSize:n,maxPage:i,data:e.slice(s,r)}}},t.MySqlSource=class{},t.LocalFileSource=class{constructor(e){this.data=e}selectPage(e,t=1,n=10){const s=[];return this.data.forEach((t=>{for(const n in e){const s=t[n],r=e[n];if("%"==r[0]){if(!s.includes(r.slice(1,r.length-1)))return!1}else if(r!==s)return!1}s.push(t)})),this.page(s,t,n)}page(e,t=1,n=10){const s=(t-1)*n,r=s+n;let a=e.length,i=0;for(;a>0;)a-=n,i++;return{page:t,pageSize:n,maxPage:i,total:e.length,data:e.slice(s,r)}}select(e){return null}update(e,t){}delete(e){}insert(e){}},t.QueryWrapper=class{constructor(e){this.dataSource=e}selectPage(e,t=1,n=10){return this.dataSource.selectPage(e,t,n)}}},5103:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.systemInfo=void 0;const r=s(n(2037)),a=s(n(7411)),i=s(n(7147)),o={type:r.default.type(),hostname:r.default.hostname(),platform:r.default.platform(),release:r.default.release(),uptime:r.default.uptime(),cwd:process.cwd(),loadavg:r.default.loadavg(),freemem:0,cpuUsage:0,memUsage:0,totalmem:0,processCpu:0,processMem:0};function c(){o.freemem=r.default.freemem(),o.totalmem=r.default.totalmem(),o.memUsage=(r.default.totalmem()-r.default.freemem())/r.default.totalmem(),a.default.cpuUsage((e=>o.cpuUsage=e))}setInterval((()=>"linux"===r.default.platform()?function(){var e;try{const t=i.default.readFileSync("/proc/meminfo",{encoding:"utf-8"}).split("\n"),n={};t.forEach((e=>{const t=e.split(":");if(2===t.length){const e=t[0].replace(/ /gim,"").replace(/\t/gim,"").trim().toLowerCase();let s=t[1].replace(/ /gim,"").replace(/\t/gim,"").trim().toLowerCase();s=s.replace(/kb/gim,"").replace(/mb/gim,"").replace(/gb/gim,"");let r=parseInt(s);isNaN(r)&&(r=0),n[e]=r}}));const s=null!==(e=n.memavailable)&&void 0!==e?e:n.memfree,r=n.memtotal;o.freemem=1024*s,o.totalmem=1024*r,o.memUsage=(o.totalmem-o.freemem)/o.totalmem,a.default.cpuUsage((e=>o.cpuUsage=e))}catch(e){c()}}():"win32"===r.default.platform()?(o.freemem=r.default.freemem(),o.totalmem=r.default.totalmem(),o.memUsage=(r.default.totalmem()-r.default.freemem())/r.default.totalmem(),void a.default.cpuUsage((e=>o.cpuUsage=e))):c()),3e3),t.systemInfo=function(){return o}},2270:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(1017)),i=s(n(4470));class o{checkFileName(e){const t=["\\","/",".."];for(const n of t)if(e.includes(n))return!1;return!0}store(e,t,n){const s=a.default.join(o.STIRAGE_DATA_PATH,e);if(i.default.existsSync(s)||i.default.mkdirsSync(s),!this.checkFileName(t))throw new Error(r.$t("common.uuidIrregular",{uuid:t}));const c=a.default.join(s,`${t}.json`),u=JSON.stringify(n,null,4);i.default.writeFileSync(c,u,{encoding:"utf-8"})}defineAttr(e,t){for(const n of Object.keys(e)){const s=t[n];void 0!==s&&(s instanceof Array?e[n]=s:s instanceof Object&&"object"==typeof s?this.defineAttr(e[n],s):e[n]=s)}return e}load(e,t,n){const s=a.default.join(o.STIRAGE_DATA_PATH,e);if(i.default.existsSync(s)||i.default.mkdirsSync(s),!this.checkFileName(n))throw new Error(r.$t("common.uuidIrregular",{uuid:n}));const c=a.default.join(s,`${n}.json`);if(!i.default.existsSync(c))return null;const u=i.default.readFileSync(c,{encoding:"utf-8"}),l=JSON.parse(u),d=new t;return this.defineAttr(d,l)}list(e){const t=a.default.join(o.STIRAGE_DATA_PATH,e);i.default.existsSync(t)||i.default.mkdirsSync(t);const n=i.default.readdirSync(t),s=new Array;return n.forEach((e=>{s.push(e.replace(a.default.extname(e),""))})),s}delete(e,t){const n=a.default.join(o.STIRAGE_DATA_PATH,e,`${t}.json`);i.default.existsSync(n)&&i.default.removeSync(n)}}o.STIRAGE_DATA_PATH=a.default.normalize(a.default.join(process.cwd(),"data")),o.STIRAGE_INDEX_PATH=a.default.normalize(a.default.join(process.cwd(),"data","index")),t.default=new o},4397:(e,t)=>{function n(e){return null==e}Object.defineProperty(t,"__esModule",{value:!0}),t.supposeValue=t.isEmpty=t.toBoolean=t.toNumber=t.toText=t.configureEntityParams=void 0,t.configureEntityParams=function(e,t,n,s){var r;const a=null!==(r=e[n])&&void 0!==r?r:null,i=null!=t[n]?t[n]:a;if(s!==Number)if(s!==String)if(s!==Boolean)if(s!==Array)e[n]=s?s(i):i;else{if(null==i)return e[n]=null;if(!(i instanceof Array))throw new Error("ConfigureEntityParams Error: Expected type to be Array, but got "+typeof i)}else e[n]=null!=i&&Boolean(i);else e[n]=null==i?null:String(i);else if(""===i||null==i)e[n]=null;else{if(isNaN(Number(i)))throw new Error("ConfigureEntityParams Error: Expected type to be Number, but got "+typeof i);e[n]=Number(i)}},t.toText=function(e){return n(e)?null:String(e)},t.toNumber=function(e){return n(e)||isNaN(Number(e))?null:Number(e)},t.toBoolean=function(e){return n(e)?null:Boolean(e)},t.isEmpty=n,t.supposeValue=function(e,t=null){return n(e)?t:e}},5018:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IGNORE=t.FRPC_PATH=t.LOCAL_PRESET_LANG_PATH=t.PTY_PATH=t.FILENAME_BLACKLIST=void 0;const r=s(n(2037)),a=s(n(1017)),i=`${r.default.platform()}_${r.default.arch()}${"win32"===r.default.platform()?".exe":""}`,o=`pty_${i}`,c=`frpc_${i}`,u=a.default.normalize(a.default.join(process.cwd(),"lib",o));t.PTY_PATH=u;const l=a.default.normalize(a.default.join(process.cwd(),"lib",c));t.FRPC_PATH=l,t.FILENAME_BLACKLIST=["\\","/",".","'",'"',"?","*","<",">"];const d=a.default.normalize(a.default.join(process.cwd(),"language"));t.LOCAL_PRESET_LANG_PATH=d,t.IGNORE="[IGNORE_LOG]"},232:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.info=e}async exec(e){}async stop(e){}}},8127:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commandStringToArray=void 0;const s=n(3640);t.commandStringToArray=function(e){const t="{quotes}";let n=0,r=e.length;const a=[];function i(t){if(t!=n){const s=e.slice(n,t);return n=t,a.push(s)}}function o(t){for(let n=t+1;n<r;n++)if('"'===e[n])return n;throw new Error(s.$t("command.quotes"))}if(function(){for(let t=n;t<r;t++){const s=e[t];if(" "!==s){if('"'===s&&(t=o(t)),t+1>=r){a.push(e.slice(n));break}}else i(t),n++}}(),0==a.length)throw new Error(s.$t("command.errLen"));for(const e in a){const n=a[e];for('"'===n[0]&&'"'===n[n.length-1]&&(a[e]=n.slice(1,n.length-1));-1!=a[e].indexOf(t);)a[e]=a[e].replace(t,'"')}return a}},5202:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232));class a extends r.default{constructor(e){super("SendCommand"),this.cmd=e}async exec(e){return await e.execPreset("command",this.cmd)}}t.default=a},9659:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(5275)),a=s(n(232)),i=s(n(699)),o=s(n(156)),c=s(n(3198)),u=s(n(1878)),l=s(n(3565)),d=s(n(9609)),f=s(n(717)),p=s(n(599)),h=s(n(6369)),m=s(n(1819)),g=s(n(3088)),_=s(n(3485)),y=s(n(8378)),w=s(n(7142)),k=s(n(8229));class P extends a.default{constructor(){super("FunctionDispatcher")}async exec(e){e.lifeCycleTaskManager.clearLifeCycleTask(),e.clearPreset(),e.lifeCycleTaskManager.registerLifeCycleTask(new m.default),e.lifeCycleTaskManager.registerLifeCycleTask(new k.default),e.setPreset("command",new f.default),e.setPreset("stop",new l.default),e.setPreset("kill",new d.default),e.setPreset("restart",new p.default),e.setPreset("update",new _.default),e.config.processType&&"general"!==e.config.processType||e.setPreset("start",new u.default),e.config.terminalOption.pty&&e.config.terminalOption.ptyWindowCol&&e.config.terminalOption.ptyWindowRow&&"general"===e.config.processType&&(e.setPreset("start",new y.default),e.setPreset("stop",new w.default),e.setPreset("resize",new c.default)),"docker"===e.config.processType&&(e.setPreset("resize",new c.default),e.setPreset("start",new h.default)),e.config.type.includes(r.default.TYPE_UNIVERSAL)&&e.setPreset("getPlayer",new c.default),e.config.type.includes(r.default.TYPE_MINECRAFT_JAVA)&&(e.setPreset("getPlayer",new o.default),e.lifeCycleTaskManager.registerLifeCycleTask(new i.default)),e.config.type.includes(r.default.TYPE_MINECRAFT_BEDROCK)&&(e.setPreset("getPlayer",new g.default),e.lifeCycleTaskManager.registerLifeCycleTask(new i.default))}}t.default=P},6369:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DockerProcessAdapter=void 0;const r=n(3640),a=s(n(232)),i=s(n(4856)),o=s(n(3018)),c=n(1239),u=s(n(4470)),l=n(8127),d=s(n(1017)),f=process.getuid?process.getuid:()=>0,p=process.getgid?process.getgid:()=>0;class h extends Error{constructor(e){super(e)}}class m extends c.EventEmitter{constructor(e){super(),this.container=e}async start(e){try{await this.container.start();const{isTty:t,h:n,w:s}=e;t&&this.container.resize({h:n,w:s}),this.pid=this.container.id;const r=this.stream=await this.container.attach({stream:!0,stdout:!0,stderr:!0,stdin:!0});r.on("data",(e=>this.emit("data",e))),r.on("error",(e=>this.emit("data",e))),this.wait()}catch(e){throw this.kill(),e}}write(e){this.stream&&this.stream.write(e)}async kill(e){return await this.container.kill(),!0}async destroy(){try{await this.container.remove()}catch(e){}}wait(){this.container.wait((async e=>{await this.destroy(),this.emit("exit",e)}))}}t.DockerProcessAdapter=m;class g extends a.default{constructor(){super("DockerStartCommand")}async exec(e,t="Unknown"){if(!(e.config.startCommand&&e.config.cwd&&e.config.ie&&e.config.oe))return e.failure(new h(r.$t("instance.dirEmpty")));if(!u.default.existsSync(e.absoluteCwdPath()))return e.failure(new h(r.$t("instance.dirNoE")));const n=l.commandStringToArray(e.config.startCommand),s=e.absoluteCwdPath(),a=e.config.docker.ports,c={},g={};for(const e of a){const t=e.split("/");if(2!=t.length)continue;const n=t[0],s=t[1],r=n.split(":");2==r.length&&(c[`${r[1]}/${s}`]=[{HostPort:r[0]}],g[`${r[1]}/${s}`]={})}const _=e.config.docker.extraVolumes,y=[];for(const e of _){if(!e)continue;const t=e.split(":");if(t.length<2)continue;let n=t[0],s=t.slice(1).join(":");s=d.default.isAbsolute(s)?d.default.normalize(s):d.default.normalize(d.default.join("/workspace/",s)),n=d.default.isAbsolute(n)?d.default.normalize(n):d.default.normalize(d.default.join(process.cwd(),n)),y.push(`${n}:${s}`)}let w,k,P,v;e.config.docker.memory&&(w=1024*e.config.docker.memory*1024),e.config.docker.cpuUsage&&(k=10*e.config.docker.cpuUsage*1e3,P=1e6),e.config.docker.cpusetCpus&&(e.config.docker.cpusetCpus.split(",").forEach((e=>{if(isNaN(Number(e)))throw new Error(r.$t("instance.invalidCpu",{v:e}))})),v=e.config.docker.cpusetCpus);let E=e.config.docker.containerName;if(E&&(E.length>64||E.length<2))throw new Error(r.$t("instance.invalidContainerName",{v:E}));o.default.info("----------------"),o.default.info(`Session ${t}: Request to start an instance`),o.default.info(`UUID: [${e.instanceUuid}] [${e.config.nickname}]`),o.default.info(`NAME: [${E}]`),o.default.info(`COMMAND: ${n.join(" ")}`),o.default.info(`WORKSPACE: ${s}`),o.default.info(`NET_MODE: ${e.config.docker.networkMode}`),o.default.info(`OPEN_PORT: ${JSON.stringify(c)}`),o.default.info(`EXT_MOUNT: ${JSON.stringify(y)}`),o.default.info(`NET_ALIASES: ${JSON.stringify(e.config.docker.networkAliases)}`),o.default.info(`MEM_LIMIT: ${w} MB`),o.default.info("TYPE: Docker Container"),o.default.info("----------------");const S=e.config.terminalOption.pty,T=new i.default,C=await T.createContainer({name:E,Image:e.config.docker.image,AttachStdin:!0,AttachStdout:!0,AttachStderr:!0,Tty:S,User:`${f()}:${p()}`,WorkingDir:"/workspace/",Cmd:n,OpenStdin:!0,StdinOnce:!1,ExposedPorts:g,HostConfig:{Memory:w,Binds:[`${s}:/workspace/`,...y],AutoRemove:!0,CpusetCpus:v,CpuPeriod:P,CpuQuota:k,PortBindings:c,NetworkMode:e.config.docker.networkMode},NetworkingConfig:{EndpointsConfig:{[e.config.docker.networkMode]:{Aliases:e.config.docker.networkAliases}}}}),b=new m(C);await b.start({isTty:S,w:e.config.terminalOption.ptyWindowCol,h:e.config.terminalOption.ptyWindowCol}),e.started(b),o.default.info(r.$t("instance.successful",{v:`${e.config.nickname} ${e.instanceUuid}`}))}}t.default=g},717:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=n(5135),i=s(n(232));class o extends i.default{constructor(){super("SendCommand")}async exec(e,t){return e.process||e.failure(new Error(r.$t("command.instanceNotOpen"))),e.process.write(a.encode(t,e.config.oe)),2===e.config.crlf?e.process.write("\r\n"):e.process.write("\n")}}t.default=o},9609:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232));class a extends r.default{constructor(){super("KillCommand")}async exec(e){e.process&&await e.process.kill("SIGKILL"),e.setLock(!1)}}t.default=a},599:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(5275)),i=s(n(232));class o extends i.default{constructor(){super("GeneralRestartCommand")}async exec(e){try{e.println("INFO",r.$t("restart.start")),await e.execPreset("stop"),e.setLock(!0);const t=e.startCount,n=setInterval((async()=>{try{if(t!==e.startCount)throw new Error(r.$t("restart.error1"));if(e.status()!==a.default.STATUS_STOPPING&&e.status()!==a.default.STATUS_STOP)throw new Error(r.$t("restart.error2"));e.status()===a.default.STATUS_STOP&&(e.println("INFO",r.$t("restart.restarting")),await e.execPreset("start"),e.setLock(!1),clearInterval(n))}catch(t){clearInterval(n),e.setLock(!1),e.failure(t)}}),1e3)}catch(t){e.setLock(!1),e.failure(t)}}}t.default=o},1878:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(3018)),i=s(n(4470)),o=s(n(232)),c=s(n(1239)),u=n(2081),l=n(8127),d=n(5927);class f extends Error{constructor(e){super(e)}}class p extends c.default{constructor(e){super(),this.process=e,this.pid=this.process.pid,e.stdout.on("data",(e=>this.emit("data",e))),e.stderr.on("data",(e=>this.emit("data",e))),e.on("exit",(e=>this.emit("exit",e)))}write(e){return this.process.stdin.write(e)}kill(e){return d.killProcess(this.pid,this.process,e)}async destroy(){var e,t,n,s,r;try{for(const e of this.eventNames())this.removeAllListeners(e);if(this.process.stdout)for(const e of this.process.stdout.eventNames())this.process.stdout.removeAllListeners(e);if(this.process.stderr)for(const e of this.process.stderr.eventNames())this.process.stderr.removeAllListeners(e);if(this.process)for(const e of this.process.eventNames())this.process.removeAllListeners(e);null===(t=null===(e=this.process)||void 0===e?void 0:e.stdout)||void 0===t||t.destroy(),null===(s=null===(n=this.process)||void 0===n?void 0:n.stderr)||void 0===s||s.destroy(),null===(null===(r=this.process)||void 0===r?void 0:r.exitCode)&&(this.process.kill("SIGTERM"),this.process.kill("SIGKILL"))}catch(e){}}}class h extends o.default{constructor(){super("StartCommand")}async exec(e,t="Unknown"){if(!(e.config.startCommand&&e.config.cwd&&e.config.ie&&e.config.oe))return e.failure(new f(r.$t("general_start.instanceConfigErr")));if(!i.default.existsSync(e.absoluteCwdPath()))return e.failure(new f(r.$t("general_start.cwdPathNotExist")));const n=l.commandStringToArray(e.config.startCommand),s=n[0],o=n.slice(1);if(0===n.length)return e.failure(new f(r.$t("general_start.cmdEmpty")));a.default.info("----------------"),a.default.info(r.$t("general_start.startInstance",{source:t})),a.default.info(r.$t("general_start.instanceUuid",{uuid:e.instanceUuid})),a.default.info(r.$t("general_start.startCmd",{cmdList:JSON.stringify(n)})),a.default.info(r.$t("general_start.cwd",{cwd:e.config.cwd})),a.default.info("----------------");const c=u.spawn(s,o,{cwd:e.config.cwd,stdio:"pipe",windowsHide:!0});if(!c||!c.pid)throw e.println("ERROR",r.$t("general_start.pidErr",{startCommand:e.config.startCommand,commandExeFile:s,commandParameters:JSON.stringify(o)})),new f(r.$t("general_start.startErr"));const d=new p(c);e.started(d),a.default.info(r.$t("general_start.startSuccess",{instanceUuid:e.instanceUuid,pid:c.pid})),e.println("INFO",r.$t("general_start.startOrdinaryTerminal"))}}t.default=h},3565:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(5275)),i=s(n(232)),o=s(n(5202));class c extends i.default{constructor(){super("StopCommand")}async exec(e){const t=e.config.stopCommand;if(e.status()===a.default.STATUS_STOP||!e.process)return e.failure(new Error(r.$t("general_stop.notRunning")));e.status(a.default.STATUS_STOPPING),"^c"==t.toLocaleLowerCase()?e.process.kill("SIGINT"):await e.exec(new o.default(t)),e.println("INFO",r.$t("general_stop.execCmd",{stopCommand:t}));const n=e.startCount;return setTimeout((()=>{e.status()===a.default.STATUS_STOPPING&&e.startCount===n&&(e.println("ERROR",r.$t("general_stop.stopErr")),e.status(a.default.STATUS_RUNNING))}),6e5),e}}t.default=c},3485:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=n(5927),i=n(2081),o=s(n(3018)),c=s(n(5275)),u=s(n(232)),l=n(8127),d=s(n(5135));class f extends u.default{constructor(){super("GeneralUpdateCommand"),this.pid=null,this.process=null}stopped(e){e.asynchronousTask=null,e.setLock(!1),e.status(c.default.STATUS_STOP)}async exec(e){if(e.status()!==c.default.STATUS_STOP)return e.failure(new Error(r.$t("general_update.statusErr_notStop")));if(null!==e.asynchronousTask)return e.failure(new Error(r.$t("general_update.statusErr_otherProgress")));try{e.setLock(!0);let t=e.config.updateCommand;t=t.replace(/\$\{mcsm_workspace\}/gm,e.config.cwd),o.default.info(r.$t("general_update.readyUpdate",{instanceUuid:e.instanceUuid})),o.default.info(r.$t("general_update.updateCmd",{instanceUuid:e.instanceUuid})),o.default.info(t);const n=l.commandStringToArray(t),s=n[0],a=n.slice(1);if(0===n.length)return e.failure(new Error(r.$t("general_update.cmdFormatErr")));const u=i.spawn(s,a,{cwd:e.config.cwd,stdio:"pipe",windowsHide:!0});if(!u||!u.pid)return this.stopped(e),e.println(r.$t("general_update.err"),r.$t("general_update.updateFailed"));this.pid=u.pid,this.process=u,e.asynchronousTask=this,e.status(c.default.STATUS_BUSY),u.stdout.on("data",(t=>{e.print(d.default.decode(t,e.config.oe))})),u.stderr.on("data",(t=>{e.print(d.default.decode(t,e.config.oe))})),u.on("exit",(t=>{this.stopped(e),0===t?e.println(r.$t("general_update.update"),r.$t("general_update.updateSuccess")):e.println(r.$t("general_update.update"),r.$t("general_update.updateErr"))}))}catch(t){this.stopped(e),e.println(r.$t("general_update.update"),r.$t("general_update.error",{err:t}))}}async stop(e){o.default.info(r.$t("general_update.terminateUpdate",{instanceUuid:e.instanceUuid})),e.println(r.$t("general_update.update"),r.$t("general_update.terminateUpdate",{instanceUuid:e.instanceUuid})),e.println(r.$t("general_update.update"),r.$t("general_update.killProcess")),a.killProcess(this.pid,this.process)}}t.default=f},223:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232));class a extends r.default{constructor(){super("KillCommand")}async exec(e){return e.config.eventTask&&e.config.eventTask.autoRestart&&(e.config.eventTask.ignore=!0),await e.execPreset("kill")}}t.default=a},3198:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232));class a extends r.default{constructor(){super("NullCommand")}async exec(){}}t.default=a},8961:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(3691)),a=s(n(232));class i extends a.default{constructor(){super("ProcessInfo")}async exec(e){let t={cpu:0,memory:0,ppid:0,pid:0,ctime:0,elapsed:0,timestamp:0};return e.process&&e.process.pid&&(t=await r.default(e.process.pid)),t}}t.default=i},8378:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(5275)),i=s(n(3018)),o=s(n(4470)),c=s(n(1017)),u=s(n(4521)),l=s(n(232)),d=s(n(1239)),f=n(2081),p=n(8127),h=n(5927),m=s(n(9659)),g=n(5018);class _ extends Error{constructor(e){super(e)}}class y extends d.default{constructor(e,t){super(),this.process=e,this.pid=t,e.stdout.on("data",(e=>this.emit("data",e))),e.stderr.on("data",(e=>this.emit("data",e))),e.on("exit",(e=>this.emit("exit",e)))}write(e){return this.process.stdin.write(e)}kill(e){return h.killProcess(this.pid,this.process,e)}async destroy(){var e,t,n,s,r;try{for(const e of this.eventNames())this.removeAllListeners(e);if(this.process.stdout)for(const e of this.process.stdout.eventNames())this.process.stdout.removeAllListeners(e);if(this.process.stderr)for(const e of this.process.stderr.eventNames())this.process.stderr.removeAllListeners(e);if(this.process)for(const e of this.process.eventNames())this.process.stdout.removeAllListeners(e);null===(t=null===(e=this.process)||void 0===e?void 0:e.stdout)||void 0===t||t.destroy(),null===(s=null===(n=this.process)||void 0===n?void 0:n.stderr)||void 0===s||s.destroy(),null===(null===(r=this.process)||void 0===r?void 0:r.exitCode)&&(this.process.kill("SIGTERM"),this.process.kill("SIGKILL"))}catch(e){}}}class w extends l.default{constructor(){super("PtyStartCommand")}readPtySubProcessConfig(e){return new Promise(((t,n)=>{const s={pid:0},r=u.default.createInterface({input:e.stdout,crlfDelay:1/0});r.on("line",((e="")=>{try{r.removeAllListeners();const n=JSON.parse(e);if(null==n.pid)throw new Error("Error");t(n)}catch(e){t(s)}})),setTimeout((()=>{t(s)}),3e3)}))}async exec(e,t="Unknown"){if(!(e.config.startCommand&&e.config.cwd&&e.config.ie&&e.config.oe))return e.failure(new _(r.$t("pty_start.cmdErr")));if(!o.default.existsSync(e.absoluteCwdPath()))return e.failure(new _(r.$t("pty_start.cwdNotExist")));if(!c.default.isAbsolute(c.default.normalize(e.config.cwd)))return e.failure(new _(r.$t("pty_start.mustAbsolutePath")));i.default.info(r.$t("pty_start.startPty",{source:t}));let n=!0;if(o.default.existsSync(g.PTY_PATH)||(e.println("ERROR",r.$t("pty_start.startErr")),n=!1),!1===n)return e.config.terminalOption.pty=!1,await e.forceExec(new m.default),void await e.execPreset("start",t);e.setLock(!0),e.status(a.default.STATUS_STARTING),e.startCount++;const s=p.commandStringToArray(e.config.startCommand);if(0===s.length)return e.failure(new _(r.$t("pty_start.cmdEmpty")));const u=["-dir",e.config.cwd,"-cmd",JSON.stringify(s),"-size",`${e.config.terminalOption.ptyWindowCol},${e.config.terminalOption.ptyWindowRow}`,"-color","-coder",e.config.oe];i.default.info("----------------"),i.default.info(r.$t("pty_start.sourceRequest",{source:t})),i.default.info(r.$t("pty_start.instanceUuid",{instanceUuid:e.instanceUuid})),i.default.info(r.$t("pty_start.startCmd",{cmd:s.join(" ")})),i.default.info(r.$t("pty_start.ptyPath",{path:g.PTY_PATH})),i.default.info(r.$t("pty_start.ptyParams",{param:u.join(" ")})),i.default.info(r.$t("pty_start.ptyCwd",{cwd:e.config.cwd})),i.default.info("----------------");const l=f.spawn(g.PTY_PATH,u,{cwd:c.default.dirname(g.PTY_PATH),stdio:"pipe",windowsHide:!0});if(!l||!l.pid)throw e.println("ERROR",r.$t("pty_start.pidErr",{startCommand:e.config.startCommand,path:g.PTY_PATH,params:JSON.stringify(u)})),new _(r.$t("pty_start.instanceStartErr"));const d=await this.readPtySubProcessConfig(l),h=new y(l,d.pid);if(i.default.info(`pty.exe response: ${JSON.stringify(d)}`),null!==l.exitCode||null==h.pid||0===h.pid)throw e.println("ERROR",r.$t("pty_start.pidErr",{startCommand:e.config.startCommand,path:g.PTY_PATH,params:JSON.stringify(u)})),new _(r.$t("pty_start.instanceStartErr"));e.started(h),i.default.info(r.$t("pty_start.startSuccess",{instanceUuid:e.instanceUuid,pid:d.pid})),e.println("INFO",r.$t("pty_start.startEmulatedTerminal"))}}t.default=w},7142:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(5275)),i=s(n(232)),o=s(n(5202));class c extends i.default{constructor(){super("PtyStopCommand")}async exec(e){let t=e.config.stopCommand;if(e.status()===a.default.STATUS_STOP||!e.process)return e.failure(new Error(r.$t("pty_stop.notRunning")));e.status(a.default.STATUS_STOPPING),e.println("INFO",r.$t("pty_stop.execCmd",{stopCommand:t})),"^c"==t.toLowerCase()&&(t=""),await e.exec(new o.default(t));const n=e.startCount;return setTimeout((()=>{e.status()===a.default.STATUS_STOPPING&&e.startCount===n&&(e.println("ERROR",r.$t("pty_stop.stopErr")),e.status(a.default.STATUS_RUNNING))}),6e5),e}}t.default=c},7765:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232));class a extends r.default{constructor(){super("RestartCommand")}async exec(e){return e.config.eventTask&&e.config.eventTask.autoRestart&&(e.config.eventTask.ignore=!0),await e.execPreset("restart")}}t.default=a},1155:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(5275)),i=s(n(232));class o extends Error{constructor(e){super(e)}}class c extends i.default{constructor(e="Unknown"){super("StartCommand"),this.source=e}async sleep(){return new Promise((e=>{setTimeout(e,3e3)}))}async exec(e){if(e.status()!==a.default.STATUS_STOP)return e.failure(new o(r.$t("start.instanceNotDown")));try{e.setLock(!0),e.status(a.default.STATUS_STARTING),e.startCount++;const t=new Date(e.config.endTime).getTime();if(t&&t<=(new Date).getTime())throw new Error(r.$t("start.instanceMaturity"));const n=(new Date).getTime();return e.startTimestamp=n,e.println("INFO",r.$t("start.startInstance")),await this.sleep(),await e.execPreset("start",this.source)}catch(t){e.releaseResources(),e.status(a.default.STATUS_STOP),e.failure(t)}finally{e.setLock(!1)}}}t.default=c},3777:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232));class a extends r.default{constructor(){super("StopCommand")}async exec(e){return e.config.eventTask&&e.config.eventTask.autoRestart&&(e.config.eventTask.ignore=!0),await e.execPreset("stop")}}t.default=a},8229:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenFrp=void 0;const r=s(n(1017)),a=s(n(3018)),i=n(5927),o=n(5018);class c{constructor(e,t){this.token=e,this.tunnelId=t,this.processWrapper=new i.processWrapper(o.FRPC_PATH,["-u",this.token,"-p",this.tunnelId],r.default.dirname(o.FRPC_PATH))}open(){if(a.default.info("Start openfrp:",o.FRPC_PATH),this.processWrapper.start(),!this.processWrapper.getPid())throw new Error("pid is null")}stop(){try{null==this.processWrapper.exitCode()&&this.processWrapper.kill(),this.processWrapper=null}catch(e){}}}t.OpenFrp=c,t.default=class{constructor(){this.status=0,this.name="openfrp"}async start(e){var t;const{openFrpToken:n,openFrpTunnelId:s}=null===(t=e.config)||void 0===t?void 0:t.extraServiceConfig;if(n&&s){const t=new c(n,s);t.processWrapper.on("start",(r=>{a.default.info(`Instance ${e.config.nickname}(${e.instanceUuid}) ${r} Frp task started!`),a.default.info(`Params: ${s} | ${n}`),e.openFrp=t,e.info.openFrpStatus=!0})),t.processWrapper.on("exit",(()=>{a.default.info(`Instance ${e.config.nickname}(${e.instanceUuid}) Frp task stopped!`),e.info.openFrpStatus=!1,e.openFrp=null}));try{t.open()}catch(t){a.default.warn(`Instance ${e.config.nickname}(${e.instanceUuid}) Frp task Start failure! ERR:`),a.default.warn(t)}}}async stop(e){e.openFrp&&e.openFrp.stop()}}},699:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="RefreshPlayer",this.status=0,this.task=null,this.playersChartTask=null,this.playersChart=[]}async start(e){this.task=setInterval((async()=>{try{const t=await e.execPreset("getPlayer");if(!t)return;e.info.maxPlayers=t.max_players?t.max_players:-1,e.info.currentPlayers=t.current_players?t.current_players:-1,e.info.version=t.version?t.version:"",0===this.playersChart.length&&this.initPlayersChart(e)}catch(e){}}),3e3),this.playersChartTask=setInterval((()=>{this.getPlayersChartData(e)}),6e5)}initPlayersChart(e){for(;this.playersChart.length<60;)this.playersChart.push({value:"0"});e.info.playersChart=this.playersChart,this.getPlayersChartData(e)}getPlayersChartData(e){var t;try{this.playersChart.shift(),this.playersChart.push({value:null!==(t=String(e.info.currentPlayers))&&void 0!==t?t:"0"}),e.info.playersChart=this.playersChart}catch(e){}}async stop(e){clearInterval(this.task),clearInterval(this.playersChartTask),e.info.maxPlayers=-1,e.info.currentPlayers=-1,e.info.version="",e.info.playersChart=[],this.playersChart=[],this.playersChartTask=null,this.task=null}}},1819:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(223));t.default=class{constructor(){this.status=0,this.name="TimeCheck",this.task=null}async start(e){this.task=setInterval((async()=>{const t=new Date(e.config.endTime).getTime();t&&t<=(new Date).getTime()&&(await e.exec(new r.default),clearInterval(this.task))}),36e5)}async stop(e){clearInterval(this.task)}}},8222:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.globalEnv=t.Config=t.globalConfiguration=void 0;const r=n(5828),a=s(n(2270));class i{constructor(){this.version=2,this.ip="",this.port=24444,this.key=function(){const e=`${r.v4().replace(/\-/gim,"")}`;return e.slice(0,e.length/2-1)+`${r.v4().replace(/\-/gim,"")}`}(),this.maxFileTask=2,this.maxZipFileSize=60,this.language="en_us"}}t.Config=i;class o{constructor(){this.config=new i}load(){let e=a.default.load("Config",i,o.ID);null==e&&(e=new i,a.default.store("Config",o.ID,e)),this.config=e}store(){a.default.store("Config",o.ID,this.config)}}o.ID="global";const c=new o;t.globalConfiguration=c;const u=new class{constructor(){this.fileTaskCount=0}};t.globalEnv=u},2827:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,n,s){this.uuid=e,this.socket=t,this.session=n,this.event=s}response(e){return this}}},8485:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(5275)),a=s(n(2037));t.default=class{constructor(){this.nickname="Undefined",this.startCommand="",this.stopCommand="^C",this.cwd=".",this.ie="utf-8",this.oe="utf-8",this.createDatetime=(new Date).toLocaleDateString(),this.lastDatetime="--",this.type=r.default.TYPE_UNIVERSAL,this.tag=[],this.endTime="",this.fileCode="utf-8",this.processType="general",this.updateCommand="",this.crlf="win32"===a.default.platform()?2:1,this.actionCommandList=[],this.terminalOption={haveColor:!0,pty:!0,ptyWindowCol:140,ptyWindowRow:40},this.eventTask={autoStart:!1,autoRestart:!1,ignore:!1},this.docker={containerName:"",image:"",ports:[],extraVolumes:[],memory:null,networkMode:"bridge",networkAliases:[],cpusetCpus:"",cpuUsage:null,maxSpace:null,io:null,network:null},this.pingConfig={ip:"",port:25565,type:1},this.extraServiceConfig={openFrpTunnelId:"",openFrpToken:""}}}},5275:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(5135)),i=s(n(1017)),o=s(n(4470)),c=n(1239),u=s(n(2270)),l=n(513),d=n(6415),f=s(n(9659)),p=s(n(1155)),h=n(4397),m=n(5018);class g extends c.EventEmitter{constructor(e,t){if(super(),this.startTimestamp=0,this.asynchronousTask=null,this.lifeCycleTaskManager=new l.LifeCycleTaskManager(this),this.presetCommandManager=new d.PresetCommandManager(this),this.info={currentPlayers:-1,maxPlayers:-1,version:"",fileLock:0,playersChart:[],openFrpStatus:!1},!e||!t)throw new Error(r.$t("instanceConf.initInstanceErr"));this.instanceStatus=g.STATUS_STOP,this.instanceUuid=e,this.lock=!1,this.config=t,this.process=null,this.startCount=0}parameters(e){var t,n,s;if((null==e?void 0:e.type)&&(null==e?void 0:e.type)!=this.config.type){if(this.status()!=g.STATUS_STOP)throw new Error(r.$t("instanceConf.cantModifyInstanceType"));h.configureEntityParams(this.config,e,"type",String),this.forceExec(new f.default)}if((null==e?void 0:e.processType)&&(null==e?void 0:e.processType)!==this.config.processType){if(this.status()!=g.STATUS_STOP)throw new Error(r.$t("instanceConf.cantModifyProcessType"));h.configureEntityParams(this.config,e,"processType",String),this.forceExec(new f.default)}if(null!=(null===(t=null==e?void 0:e.terminalOption)||void 0===t?void 0:t.pty)&&(null===(n=null==e?void 0:e.terminalOption)||void 0===n?void 0:n.pty)!==this.config.terminalOption.pty){if(this.status()!=g.STATUS_STOP)throw new Error(r.$t("instanceConf.cantModifyPtyModel"));if(!o.default.existsSync(m.PTY_PATH)&&!0===(null===(s=null==e?void 0:e.terminalOption)||void 0===s?void 0:s.pty))throw new Error(r.$t("instanceConf.ptyNotExist",{path:m.PTY_PATH}));h.configureEntityParams(this.config.terminalOption,e.terminalOption,"pty",Boolean),this.forceExec(new f.default)}this.status()===g.STATUS_STOP&&e.terminalOption&&(h.configureEntityParams(this.config.terminalOption,e.terminalOption,"ptyWindowCol",Number),h.configureEntityParams(this.config.terminalOption,e.terminalOption,"ptyWindowRow",Number)),(null==e?void 0:e.extraServiceConfig)&&(h.configureEntityParams(this.config.extraServiceConfig,e.extraServiceConfig,"isOpenFrp",Boolean),h.configureEntityParams(this.config.extraServiceConfig,e.extraServiceConfig,"openFrpToken",String),h.configureEntityParams(this.config.extraServiceConfig,e.extraServiceConfig,"openFrpTunnelId",String)),h.configureEntityParams(this.config,e,"nickname",String),h.configureEntityParams(this.config,e,"startCommand",String),h.configureEntityParams(this.config,e,"stopCommand",String),h.configureEntityParams(this.config,e,"cwd",String),h.configureEntityParams(this.config,e,"ie",String),h.configureEntityParams(this.config,e,"oe",String),h.configureEntityParams(this.config,e,"crlf",Number),h.configureEntityParams(this.config,e,"endTime",String),h.configureEntityParams(this.config,e,"fileCode",String),h.configureEntityParams(this.config,e,"updateCommand",String),e.docker&&(h.configureEntityParams(this.config.docker,e.docker,"containerName",String),h.configureEntityParams(this.config.docker,e.docker,"image",String),h.configureEntityParams(this.config.docker,e.docker,"memory",Number),h.configureEntityParams(this.config.docker,e.docker,"ports"),h.configureEntityParams(this.config.docker,e.docker,"extraVolumes"),h.configureEntityParams(this.config.docker,e.docker,"maxSpace",Number),h.configureEntityParams(this.config.docker,e.docker,"io",Number),h.configureEntityParams(this.config.docker,e.docker,"network",Number),h.configureEntityParams(this.config.docker,e.docker,"networkMode",String),h.configureEntityParams(this.config.docker,e.docker,"networkAliases"),h.configureEntityParams(this.config.docker,e.docker,"cpusetCpus",String),h.configureEntityParams(this.config.docker,e.docker,"cpuUsage",Number)),e.pingConfig&&(h.configureEntityParams(this.config.pingConfig,e.pingConfig,"ip",String),h.configureEntityParams(this.config.pingConfig,e.pingConfig,"port",Number),h.configureEntityParams(this.config.pingConfig,e.pingConfig,"type",Number)),e.eventTask&&(h.configureEntityParams(this.config.eventTask,e.eventTask,"autoStart",Boolean),h.configureEntityParams(this.config.eventTask,e.eventTask,"autoRestart",Boolean),h.configureEntityParams(this.config.eventTask,e.eventTask,"ignore",Boolean)),e.terminalOption&&h.configureEntityParams(this.config.terminalOption,e.terminalOption,"haveColor",Boolean),u.default.store("InstanceConfig",this.instanceUuid,this.config)}setLock(e){this.lock=e}async execCommand(e){if(this.lock)throw new Error(r.$t("instanceConf.instanceLock",{info:e.info}));if(this.status()==g.STATUS_BUSY)throw new Error(r.$t("instanceConf.instanceBusy"));return await e.exec(this)}async exec(e){return await this.execCommand(e)}async forceExec(e){return await e.exec(this)}status(e){return null!=e&&(this.instanceStatus=e),this.instanceStatus}started(e){this.config.lastDatetime=this.fullTime();const t=this.config.terminalOption.pty?"utf-8":this.config.oe;e.on("data",(e=>this.emit("data",a.default.decode(e,t)))),e.on("exit",(e=>this.stopped(e))),this.process=e,this.instanceStatus=g.STATUS_RUNNING,this.emit("open",this),this.lifeCycleTaskManager.execLifeCycleTask(1)}failure(e){var t;throw this.emit("failure",e),this.println("Error",null!==(t=e.message)&&void 0!==t?t:String(e)),e}stopped(e=0){this.releaseResources(),this.instanceStatus!=g.STATUS_STOP&&(this.instanceStatus=g.STATUS_STOP,this.emit("exit",e),u.default.store("InstanceConfig",this.instanceUuid,this.config)),this.lifeCycleTaskManager.execLifeCycleTask(0),this.config.eventTask.autoRestart&&(this.config.eventTask.ignore||this.forceExec(new p.default("Event Task: Auto Restart")).then((()=>{this.println(r.$t("instanceConf.info"),r.$t("instanceConf.autoRestart"))})).catch((e=>{this.println(r.$t("instanceConf.error"),r.$t("instanceConf.autoRestartErr",{err:e}))})),this.config.eventTask.ignore=!1),(new Date).getTime()-this.startTimestamp<6e3&&this.println("ERROR",r.$t("instanceConf.instantExit"))}println(e,t){const n=`\n[MCSMANAGER] [${e}] ${t}\n`;this.emit("data",n)}print(e){this.emit("data",e)}releaseResources(){this.process&&this.process.destroy(),this.process=null}destroy(){this.process&&this.process.pid&&this.process.kill("SIGKILL"),this.process=null}fullTime(){const e=new Date;return e.toLocaleDateString()+" "+e.getHours()+":"+e.getMinutes()}absoluteCwdPath(){return this.config&&this.config.cwd?i.default.isAbsolute(this.config.cwd)?i.default.normalize(this.config.cwd):i.default.normalize(i.default.join(process.cwd(),this.config.cwd)):null}async usedSpace(e,t=4,n=0){return 0}async execPreset(e,t){if(this.presetCommandManager)return await this.presetCommandManager.execPreset(e,t);throw new Error("Preset Manager does not exist")}setPreset(e,t){this.presetCommandManager.setPreset(e,t)}getPreset(e){return this.presetCommandManager.getPreset(e)}clearPreset(){this.presetCommandManager.clearPreset()}}t.default=g,g.STATUS_BUSY=-1,g.STATUS_STOP=0,g.STATUS_STOPPING=1,g.STATUS_STARTING=2,g.STATUS_RUNNING=3,g.TYPE_UNIVERSAL="universal",g.TYPE_MINECRAFT_JAVA="minecraft/java",g.TYPE_MINECRAFT_BEDROCK="minecraft/bedrock"},513:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LifeCycleTaskManager=void 0,t.LifeCycleTaskManager=class{constructor(e){this.self=e,this.lifeCycleTask=[]}registerLifeCycleTask(e){this.lifeCycleTask.push(e)}execLifeCycleTask(e){1==e?this.lifeCycleTask.forEach((e=>{0===e.status&&e.start(this.self),e.status=1})):this.lifeCycleTask.forEach((e=>{1===e.status&&e.stop(this.self),e.status=0}))}clearLifeCycleTask(){this.execLifeCycleTask(0),this.lifeCycleTask.splice(0,this.lifeCycleTask.length)}}},6415:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PresetCommandManager=void 0;const s=n(3640);t.PresetCommandManager=class{constructor(e){this.self=e,this.preset=new Map}setPreset(e,t){this.preset.set(e,t)}getPreset(e){return this.preset.get(e)}async execPreset(e,t){const n=this.preset.get(e);if(!n)throw new Error(s.$t("preset.actionErr",{action:e}));return await n.exec(this.self,t)}clearPreset(){this.preset.clear()}}},3611:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProcessConfig=void 0;const r=n(3640),a=s(n(9066)),i=s(n(1627)),o=s(n(8231)),c=s(n(1017)),u=s(n(4470)),l="utf-8";t.ProcessConfig=class{constructor(e){this.iProcessConfig=e,e.path=c.default.normalize(e.path)}read(){const e=u.default.readFileSync(this.iProcessConfig.path,{encoding:l});return"yml"===this.iProcessConfig.type?a.default.parse(e):"toml"==this.iProcessConfig.type?i.default.parse(e):"properties"===this.iProcessConfig.type?o.default.parse(e):"json"===this.iProcessConfig.type?JSON.parse(e):"txt"===this.iProcessConfig.type?e:void 0}write(e){let t="";if("yml"===this.iProcessConfig.type&&(t=a.default.stringify(e)),"toml"===this.iProcessConfig.type&&(t=i.default.stringify(e)),"properties"===this.iProcessConfig.type&&(t=o.default.stringify(e),t=t.replace(/ = /gim,"="),"server.properties"==this.iProcessConfig.fileName&&(t=t.replace(/\\\\u/gim,"\\u"))),"json"===this.iProcessConfig.type&&(t=JSON.stringify(e)),"txt"===this.iProcessConfig.type&&(t=e.toString()),!t&&"txt"!==this.iProcessConfig.type)throw new Error(r.$t("process_config.writEmpty"));u.default.writeFileSync(this.iProcessConfig.path,t,{encoding:l})}exists(){return u.default.existsSync(this.iProcessConfig.path)}}},156:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(232)),a=s(n(1787));class i extends r.default{constructor(){super("MinecraftGetPlayersCommand")}async exec(e){return e.config.pingConfig.ip&&e.config.pingConfig.port?await new a.default(e.config.pingConfig.port,e.config.pingConfig.ip).getStatus():null}}t.default=i},3088:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1891)),a=s(n(232));class i extends a.default{constructor(){super("MinecraftBedrockGetPlayersCommand")}async exec(e){if(e.config.pingConfig.ip&&e.config.pingConfig.port)try{const t=await async function(e,t){const n=Buffer.from("01 00 00 00 00 00 06 18 20 00 FF FF 00 FE FE FE FE FD FD FD FD 12 34 56 78 A3 61 1C F8 BA 8F D5 60".replace(/ /g,""),"hex"),s=r.default.createSocket("udp4");var a={ip:e,port:t};return new Promise(((e,t)=>{s.on("error",(e=>{try{s.close()}finally{t(e)}})),s.on("message",(t=>{const n=t.toString().split(";");try{s.close()}finally{e(n)}})),s.send(n,a.port,a.ip,(e=>{if(e)try{s.close()}finally{t(e)}})),setTimeout((()=>{t("request timeout");try{s.close()}catch(e){}}),3e3)}))}(e.config.pingConfig.ip,e.config.pingConfig.port);return{version:t[3],motd:t[0],current_players:t[4],max_players:t[5]}}catch(e){}return null}}t.default=i},3640:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.i18next=t.$t=void 0;const r=s(n(8805));t.i18next=r.default;const a=s(n(7169)),i=s(n(3674));r.default.init({interpolation:{escapeValue:!1},lng:"en_us",fallbackLng:"en_us",resources:{zh_cn:{translation:a.default},en_us:{translation:i.default}}});const o=r.default.t;t.$t=o},390:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3640),c=i(n(4470)),u=a(n(8742)),l=n(1018),d=i(n(9597)),f=i(n(3018)),p=i(n(1017)),h=i(n(1155)),m=i(n(3777)),g=i(n(5202)),_=i(n(223)),y=i(n(8961)),w=i(n(7701)),k=n(3611),P=i(n(7765)),v=n(6399),E=n(6674),S=n(6674);l.routerApp.use(((e,t,n,s)=>{if("instance/new"===e&&n)return s();if("instance/overview"===e)return s();if("instance/select"===e)return s();if("instance/asynchronous"===e)return s();if("instance/query_asynchronous"===e)return s();if("instance/stop_asynchronous"===e)return s();if(e.startsWith("instance")){if(n.instanceUuids)return s();const r=n.instanceUuid;if(!d.default.exists(r))return u.error(t,e,{instanceUuid:r,err:`The operation failed, the instance ${r} does not exist.`})}s()})),l.routerApp.on("instance/select",((e,t)=>{const n=t.page||1,s=t.pageSize||1,r=t.condition,a=[],i=d.default.getQueryMapWrapper();let o=i.select((e=>!!e.config.nickname.includes(r.instanceName)));const c=i.page(o,n,s);c.data.forEach((e=>{a.push({instanceUuid:e.instanceUuid,started:e.startCount,status:e.status(),config:e.config,info:e.info})})),a.sort(((e,t)=>e.config.nickname>=t.config.nickname?1:-1)),u.response(e,{page:c.page,pageSize:c.pageSize,maxPage:c.maxPage,data:a})})),l.routerApp.on("instance/overview",(e=>{const t=[];d.default.instances.forEach((e=>{t.push({instanceUuid:e.instanceUuid,started:e.startCount,status:e.status(),config:e.config,info:e.info})})),u.msg(e,"instance/overview",t)})),l.routerApp.on("instance/section",((e,t)=>{const n=t.instanceUuids,s=[];d.default.instances.forEach((e=>{n.forEach((t=>{t===e.instanceUuid&&s.push({instanceUuid:e.instanceUuid,started:e.startCount,status:e.status(),config:e.config,info:e.info})}))})),u.msg(e,"instance/section",s)})),l.routerApp.on("instance/detail",(async(e,t)=>{try{const n=t.instanceUuid,s=d.default.getInstance(n);let r=null,a=null;try{r=await s.forceExec(new y.default),a=await s.usedSpace(null,2)}catch(e){}u.msg(e,"instance/detail",{instanceUuid:s.instanceUuid,started:s.startCount,status:s.status(),config:s.config,info:s.info,space:a,processInfo:r})}catch(t){u.error(e,"instance/detail",{err:t.message})}})),l.routerApp.on("instance/new",((e,t)=>{const n=t;try{const t=d.default.createInstance(n);u.msg(e,"instance/new",{instanceUuid:t.instanceUuid,config:t.config})}catch(t){u.error(e,"instance/new",{instanceUuid:null,err:t.message})}})),l.routerApp.on("instance/update",((e,t)=>{const n=t.instanceUuid,s=t.config;try{d.default.getInstance(n).parameters(s),u.msg(e,"instance/update",{instanceUuid:n})}catch(t){u.error(e,"instance/update",{instanceUuid:n,err:t.message})}})),l.routerApp.on("instance/forward",((e,t)=>{const n=t.instanceUuid,s=t.forward;try{s?(f.default.info(o.$t("Instance_router.requestIO",{id:e.socket.id,targetInstanceUuid:n})),d.default.forward(n,e.socket)):(f.default.info(o.$t("Instance_router.cancelIO",{id:e.socket.id,targetInstanceUuid:n})),d.default.stopForward(n,e.socket)),u.msg(e,"instance/forward",{instanceUuid:n})}catch(t){u.error(e,"instance/forward",{instanceUuid:n,err:t.message})}})),l.routerApp.on("instance/open",(async(e,t)=>{const n=t.disableResponse;for(const s of t.instanceUuids){const t=d.default.getInstance(s);try{await t.exec(new h.default(e.socket.id)),n||u.msg(e,"instance/open",{instanceUuid:s})}catch(t){n||(f.default.error(o.$t("Instance_router.openInstanceErr",{instanceUuid:s}),t),u.error(e,"instance/open",{instanceUuid:s,err:t.message}))}}})),l.routerApp.on("instance/stop",(async(e,t)=>{const n=t.disableResponse;for(const s of t.instanceUuids){const t=d.default.getInstance(s);try{await t.exec(new m.default),n||u.msg(e,"instance/stop",{instanceUuid:s})}catch(t){n||u.error(e,"instance/stop",{instanceUuid:s,err:t.message})}}})),l.routerApp.on("instance/restart",(async(e,t)=>{const n=t.disableResponse;for(const s of t.instanceUuids){const t=d.default.getInstance(s);try{await t.exec(new P.default),n||u.msg(e,"instance/restart",{instanceUuid:s})}catch(t){n||u.error(e,"instance/restart",{instanceUuid:s,err:t.message})}}})),l.routerApp.on("instance/kill",(async(e,t)=>{const n=t.disableResponse;for(const s of t.instanceUuids){const t=d.default.getInstance(s);if(t)try{await t.forceExec(new _.default),n||u.msg(e,"instance/kill",{instanceUuid:s})}catch(t){n||u.error(e,"instance/kill",{instanceUuid:s,err:t.message})}}})),l.routerApp.on("instance/command",(async(e,t)=>{const n=t.disableResponse,s=t.instanceUuid,r=t.command||"",a=d.default.getInstance(s);try{await a.exec(new g.default(r)),n||u.msg(e,"instance/command",{instanceUuid:s})}catch(t){n||u.error(e,"instance/command",{instanceUuid:s,err:t.message})}})),l.routerApp.on("instance/delete",((e,t)=>{const n=t.instanceUuids,s=t.deleteFile;for(const e of n)try{d.default.removeInstance(e,s)}catch(e){}u.msg(e,"instance/delete",n)})),l.routerApp.on("instance/asynchronous",((e,t)=>{const n=t.instanceUuid,s=t.taskName,r=t.parameter,a=d.default.getInstance(n);if(f.default.info(o.$t("Instance_router.performTasks",{id:e.socket.id,uuid:n,taskName:s})),"update"===s&&a&&a.execPreset("update",r).then((()=>{})).catch((e=>{f.default.error(o.$t("Instance_router.performTasksErr",{uuid:a.instanceUuid,taskName:s,err:e}))})),"quick_install"===s){const t=String(r.newInstanceName),n=String(r.targetLink);f.default.info(`Quick install: Name: ${t} | Download: ${n}`);const s=E.createQuickInstallTask(n,t);return u.response(e,s.toObject())}u.response(e,!0)})),l.routerApp.on("instance/stop_asynchronous",((e,t)=>{const n=t.instanceUuid,{taskId:s}=t.parameter,r=d.default.getInstance(n);if(s&&"string"==typeof s){const t=v.TaskCenter.getTask(s);if(!t)throw new Error(`Async Task ID: ${s} does not exist`);return t.stop(),u.response(e,!0)}const a=null==r?void 0:r.asynchronousTask;if(!a||!a.stop)return u.error(e,"instance/stop_asynchronous",o.$t("Instance_router.taskEmpty"));a.stop(r).then((()=>{})).catch((e=>{})),u.response(e,!0)})),l.routerApp.on("instance/query_asynchronous",((e,t)=>{const n=t.parameter.taskId,s=t.taskName,r={quick_install:S.QuickInstallTask.TYPE},a=String(r[s]||S.QuickInstallTask.TYPE);if(n){const t=v.TaskCenter.getTask(String(n));t&&u.response(e,{taskId:t.taskId,status:t.status(),detail:t.toObject()})}else{const t=[];for(const e of v.TaskCenter.getTasks(a))t.push({taskId:e.taskId,status:e.status(),detail:e.toObject()});u.response(e,t)}})),l.routerApp.on("instance/process_config/list",((e,t)=>{const n=t.instanceUuid,s=t.files,r=[];try{const t=d.default.getInstance(n),a=new w.default(t.absoluteCwdPath());for(const e of s)a.check(e)&&r.push({file:e,check:!0});u.response(e,r)}catch(t){u.responseError(e,t)}})),l.routerApp.on("instance/process_config/file",((e,t)=>{const n=t.instanceUuid,s=t.fileName,r=t.config||null,a=t.type;try{const t=d.default.getInstance(n);if(!new w.default(t.absoluteCwdPath()).check(s))throw new Error(o.$t("Instance_router.accessFileErr"));const i=p.default.normalize(p.default.join(t.absoluteCwdPath(),s)),c=new k.ProcessConfig({fileName:s,redirect:s,path:i,type:a,info:null,fromLink:null});if(r)return c.write(r),u.response(e,!0);{const t=c.read();return u.response(e,t)}}catch(t){u.responseError(e,t)}})),l.routerApp.on("instance/outputlog",(async(e,t)=>{const n=t.instanceUuid;try{const t=p.default.join(d.default.LOG_DIR,`${n}.log`);if(c.default.existsSync(t)){const n=await c.default.readFile(t,{encoding:"utf-8"});return u.response(e,n)}u.responseError(e,new Error(o.$t("Instance_router.terminalLogNotExist")),{notPrintErr:!0})}catch(t){u.responseError(e,t)}}))},7098:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3640),c=n(1018),u=a(n(8742)),l=n(8222),d=i(n(3018)),f=n(5018),p="TOP_LEVEL";c.routerApp.use((async(e,t,n,s)=>{const r=t.socket;if(e.startsWith("stream"))return s();if("auth"===e)return await s();if(!t.session)throw new Error("Session does not exist in authentication middleware.");return t.session.key===l.globalConfiguration.config.key&&t.session.type===p&&t.session.login&&t.session.id?await s():(d.default.warn(o.$t("auth_router.notAccess",{id:r.id,address:r.handshake.address,event:e})),u.error(t,"error",f.IGNORE))})),c.routerApp.on("auth",((e,t)=>{t===l.globalConfiguration.config.key?(d.default.info(o.$t("auth_router.access",{id:e.socket.id,address:e.socket.handshake.address})),function(e,t){e.session.key=t,e.session.login=!0,e.session.id=e.socket.id,e.session.type=p,e.session}(e,t),u.msg(e,"auth",!0)):u.msg(e,"auth",!1)})),c.routerApp.on("connection",(e=>{const t=e.session;setTimeout((()=>{t.login||(e.socket.disconnect(),d.default.info(o.$t("auth_router.disconnect",{id:e.socket.id,address:e.socket.handshake.address})))}),6e3)}))},7232:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3640),c=n(3576),u=a(n(8742)),l=n(1018),d=a(n(4470)),f=i(n(1017)),p=n(5828),h=i(n(3018));l.routerApp.on("environment/images",(async(e,t)=>{try{const t=(new c.DockerManager).getDocker(),n=await t.listImages();u.response(e,n)}catch(t){u.responseError(e,o.$t("environment_router.dockerInfoErr"))}})),l.routerApp.on("environment/containers",(async(e,t)=>{try{const t=(new c.DockerManager).getDocker(),n=await t.listContainers();u.response(e,n)}catch(t){u.responseError(e,t)}})),l.routerApp.on("environment/networkModes",(async(e,t)=>{try{const t=(new c.DockerManager).getDocker(),n=await t.listNetworks();u.response(e,n)}catch(t){u.responseError(e,t)}})),l.routerApp.on("environment/new_image",(async(e,t)=>{try{const n=t.dockerFile,s=t.name,r=t.tag,a=p.v4(),i=f.default.normalize(f.default.join(process.cwd(),"tmp",a));d.existsSync(i)||d.mkdirsSync(i);const l=f.default.normalize(f.default.join(i,"Dockerfile"));await d.writeFile(l,n,{encoding:"utf-8"}),h.default.info(o.$t("environment_router.crateImage",{name:s,tag:r,dockerFileText:n})),u.response(e,!0);const m=`${s}:${r}`;try{await(new c.DockerManager).startBuildImage(i,m),h.default.info(o.$t("environment_router.crateSuccess",{name:s,tag:r}))}catch(e){h.default.info(o.$t("environment_router.crateErr",{name:s,tag:r,error:e}))}}catch(t){u.responseError(e,t)}})),l.routerApp.on("environment/del_image",(async(e,t)=>{try{const n=t.imageId,s=(new c.DockerManager).getDocker().getImage(n);if(!s)throw new Error("Image does not exist");h.default.info(o.$t("environment_router.delImage",{imageId:n})),await s.remove(),u.response(e,!0)}catch(t){u.responseError(e,t)}})),l.routerApp.on("environment/progress",(async e=>{try{const t={};c.DockerManager.builderProgress.forEach(((e,n)=>{t[n]=e})),u.response(e,t)}catch(t){u.responseError(e,t)}}))},2384:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3640),c=a(n(8742)),u=n(1018),l=i(n(9597)),d=n(5925),f=n(8222);u.routerApp.use(((e,t,n,s)=>{if(e.startsWith("file/")){const s=n.instanceUuid;if(!l.default.exists(s))return c.error(t,e,{instanceUuid:s,err:o.$t("file_router.instanceNotExist",{instanceUuid:s})})}s()})),u.routerApp.on("file/list",((e,t)=>{try{const n=d.getFileManager(t.instanceUuid),{page:s,pageSize:r,target:a}=t;n.cd(a);const i=n.list(s,r);c.response(e,i)}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/status",((e,t)=>{var n,s;try{const r=l.default.getInstance(t.instanceUuid);c.response(e,{instanceFileTask:null!==(n=r.info.fileLock)&&void 0!==n?n:0,globalFileTask:null!==(s=f.globalEnv.fileTaskCount)&&void 0!==s?s:0})}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/mkdir",((e,t)=>{try{const n=t.target;d.getFileManager(t.instanceUuid).mkdir(n),c.response(e,!0)}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/copy",(async(e,t)=>{try{const n=t.targets,s=d.getFileManager(t.instanceUuid);for(const e of n)s.copy(e[0],e[1]);c.response(e,!0)}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/move",(async(e,t)=>{try{const n=t.targets,s=d.getFileManager(t.instanceUuid);for(const e of n)await s.move(e[0],e[1]);c.response(e,!0)}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/delete",(async(e,t)=>{try{const n=t.targets,s=d.getFileManager(t.instanceUuid);for(const e of n)s.delete(e);c.response(e,!0)}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/edit",(async(e,t)=>{try{const n=t.target,s=t.text,r=d.getFileManager(t.instanceUuid),a=await r.edit(n,s);c.response(e,a||!0)}catch(t){c.responseError(e,t)}})),u.routerApp.on("file/compress",(async(e,t)=>{const n=f.globalConfiguration.config.maxFileTask;try{const s=t.source,r=t.targets,a=t.type,i=t.code,u=d.getFileManager(t.instanceUuid),p=l.default.getInstance(t.instanceUuid);if(p.info.fileLock>=n)throw new Error(o.$t("file_router.unzipLimit",{maxFileTask:n,fileLock:p.info.fileLock}));function h(){p.info.fileLock++,f.globalEnv.fileTaskCount++}function m(){p.info.fileLock--,f.globalEnv.fileTaskCount--}c.response(e,!0),h();try{1===a?await u.promiseZip(s,r,i):await u.promiseUnzip(s,r,i)}catch(g){throw g}finally{m()}}catch(_){c.responseError(e,_)}}))},1697:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(1511)),i=s(n(4470)),o=s(n(1017)),c=n(5496),u=s(n(9597)),l=s(n(7701)),d=new a.default;d.all("/",(async e=>{e.body="[MCSManager Daemon] Status: OK | reference: https://mcsmanager.com/",e.status=200})),d.get("/download/:key/:fileName",(async e=>{const t=e.params.key,n=e.params.fileName;try{const s=c.missionPassport.getMission(t,"download");if(!s)throw new Error(e.body="No task, Access denied");const a=u.default.getInstance(s.parameter.instanceUuid);if(!a)throw new Error(r.$t("http_router.instanceNotExist"));if(!l.default.checkFileName(n))throw new Error(r.$t("http_router.fileNameNotSpec"));const d=a.config.cwd,f=s.parameter.fileName,p=o.default.extname(f),h=new l.default(d);if(!h.check(f))throw new Error(e.body="Access denied,incorrect param");e.response.set("Content-Disposition",`attachment; filename="${encodeURIComponent(n)}"`),e.type=p,e.body=i.default.createReadStream(h.toAbsolutePath(f)),c.missionPassport.deleteMission(t)}catch(t){e.body=r.$t("http_router.downloadErr",{error:t.message}),e.status=500}finally{c.missionPassport.deleteMission(t)}})),d.post("/upload/:key",(async e=>{const t=e.params.key,n=e.query.unzip,s=String(e.query.code);try{const a=c.missionPassport.getMission(t,"upload");if(!a)throw new Error("Access denied 0x061");const d=u.default.getInstance(a.parameter.instanceUuid);if(!d)throw new Error("Access denied 0x062");const f=a.parameter.uploadDir,p=d.config.cwd,h=e.request.files.file;if(h){const t=h.name,r=o.default.normalize(o.default.join(f,t));if(!l.default.checkFileName(t))throw new Error("Access denied 0x063");const a=new l.default(p);if(!a.checkPath(r))throw new Error("Access denied 0x064");const c=a.toAbsolutePath(r),u=i.default.createReadStream(h.path),m=i.default.createWriteStream(c);return u.pipe(m),u.on("close",(()=>{n&&new l.default(d.config.cwd).unzip(t,"",s)})),e.body="OK"}e.body=r.$t("http_router.updateErr"),e.status=500}catch(t){e.body=t.message,e.status=500}finally{c.missionPassport.deleteMission(t)}})),t.default=d},6194:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(n(8742)),c=n(1018),u=i(n(9597)),l=i(n(5275)),d=n(5103),f=n(4310),p=n(8222),h=i(n(8805)),m=i(n(3018)),g=i(n(4470)),_=n(5018);c.routerApp.on("info/overview",(async e=>{const t=f.getVersion();let n=0,s=0;u.default.instances.forEach((e=>{n++,e.status()==l.default.STATUS_RUNNING&&s++}));const r={version:t,process:{cpu:process.cpuUsage().system,memory:process.memoryUsage().heapUsed,cwd:process.cwd()},instance:{running:s,total:n},system:d.systemInfo()};o.response(e,r)})),c.routerApp.on("info/setting",(async(e,t)=>{const n=String(t.language);try{m.default.warn("Language change:",n),h.default.changeLanguage(n),g.default.remove(_.LOCAL_PRESET_LANG_PATH,(()=>{})),p.globalConfiguration.config.language=n,p.globalConfiguration.store(),o.response(e,!0)}catch(t){o.responseError(e,t)}}))},8709:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(1017)),c=i(n(2827)),u=a(n(8742)),l=i(n(9597)),d=i(n(4470)),f=new Map;setInterval((()=>{f.forEach(((e,t)=>{if(!e||!t)return;const n=o.default.join(l.default.LOG_DIR,`${t}.log`);d.default.existsSync(l.default.LOG_DIR)||d.default.mkdirsSync(l.default.LOG_DIR);try{const e=d.default.statSync(n);e&&e.size>524288&&d.default.removeSync(n)}catch(e){}d.default.writeFile(n,e,{encoding:"utf-8",flag:"a"},(()=>{f.set(t,"")}))}))}),500),l.default.on("data",((e,t)=>{l.default.forEachForward(e,(n=>{u.msg(new c.default(null,n),"instance/stdout",{instanceUuid:e,text:t})})),async function(e,t){var n;const s=(null!==(n=f.get(e))&&void 0!==n?n:"")+t;s.length>1048576&&f.set(e,""),f.set(e,null!=s?s:null)}(e,t).then((()=>{})).catch((()=>{}))})),l.default.on("exit",(e=>{l.default.forEachForward(e.instanceUuid,(t=>{u.msg(new c.default(null,t),"instance/stopped",{instanceUuid:e.instanceUuid,instanceName:e.instanceName})}))})),l.default.on("open",(e=>{l.default.forEachForward(e.instanceUuid,(t=>{u.msg(new c.default(null,t),"instance/opened",{instanceUuid:e.instanceUuid,instanceName:e.instanceName})}))})),l.default.on("failure",(e=>{l.default.forEachForward(e.instanceUuid,(t=>{u.msg(new c.default(null,t),"instance/failure",{instanceUuid:e.instanceUuid,instanceName:e.instanceName})}))}))},3360:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(3640),o=n(1018),c=n(5496),u=a(n(8742));o.routerApp.on("passport/register",((e,t)=>{const n=t.name,s=t.password,r=t.parameter,a=t.count,o=(new Date).getTime(),l=o+36e5;if(!n||!s)throw new Error(i.$t("passport_router.registerErr"));c.missionPassport.registerMission(s,{name:n,parameter:r,count:a,start:o,end:l}),u.response(e,!0)}))},5995:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1018),c=a(n(8742)),u=i(n(9945));o.routerApp.on("schedule/register",((e,t)=>{try{u.default.registerScheduleJob(t),c.response(e,!0)}catch(t){c.responseError(e,t)}})),o.routerApp.on("schedule/list",((e,t)=>{c.response(e,u.default.listScheduleJob(t.instanceUuid))})),o.routerApp.on("schedule/delete",((e,t)=>{u.default.deleteScheduleTask(t.instanceUuid,t.name),c.response(e,!0)}))},7264:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3640),c=a(n(8742)),u=n(1018),l=n(5496),d=i(n(9597)),f=i(n(3018)),p=i(n(5202)),h=n(5018);u.routerApp.use((async(e,t,n,s)=>"stream/auth"===e?s():e.startsWith("stream")?t.session.stream&&!0===t.session.stream.check&&"STREAM"===t.session.type?await s():c.error(t,"error",h.IGNORE):await s())),u.routerApp.on("stream/auth",((e,t)=>{try{const n=t.password,s=l.missionPassport.getMission(n,"stream_channel");if(!s)throw new Error(o.$t("stream_router.taskNotExist"));const r=d.default.getInstance(s.parameter.instanceUuid);if(!r)throw new Error(o.$t("stream_router.instanceNotExist"));f.default.info(o.$t("stream_router.authSuccess",{id:e.socket.id,address:e.socket.handshake.address})),e.session.id=e.socket.id,e.session.login=!0,e.session.type="STREAM",e.session.stream={check:!0,instanceUuid:r.instanceUuid},d.default.forward(r.instanceUuid,e.socket),f.default.info(o.$t("stream_router.establishConnection",{id:e.socket.id,address:e.socket.handshake.address,uuid:r.instanceUuid})),e.socket.on("disconnect",(()=>{d.default.stopForward(r.instanceUuid,e.socket),f.default.info(o.$t("stream_router.disconnect",{id:e.socket.id,address:e.socket.handshake.address,uuid:r.instanceUuid}))})),c.response(e,!0)}catch(t){c.responseError(e,t,{notPrintErr:!0})}})),u.routerApp.on("stream/detail",(async e=>{try{const t=e.session.stream.instanceUuid,n=d.default.getInstance(t);c.response(e,{instanceUuid:n.instanceUuid,started:n.startCount,status:n.status(),config:n.config,info:n.info})}catch(t){c.responseError(e,t)}})),u.routerApp.on("stream/input",(async(e,t)=>{try{const n=t.command,s=e.session.stream.instanceUuid,r=d.default.getInstance(s);await r.exec(new p.default(n))}catch(e){}})),u.routerApp.on("stream/write",(async(e,t)=>{try{const n=t.input,s=e.session.stream.instanceUuid,r=d.default.getInstance(s);r.process&&r.process.write(n)}catch(e){}})),u.routerApp.on("stream/resize",(async(e,t)=>{try{const n=e.session.stream.instanceUuid,s=d.default.getInstance(n);"docker"===s.config.processType&&await s.execPreset("resize",t)}catch(e){}}))},6399:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskCenter=t.AsyncTask=void 0;const r=s(n(1239)),a=s(n(3018));class i extends r.default{constructor(){super(),this._status=0}start(){this._status=1;const e=this.onStarted();return this.emit("started"),e}stop(){-1!==this._status&&(this._status=0);const e=this.onStopped();return this.emit("stopped"),e}error(e){this._status=-1,a.default.error(`AsyncTask - ID: ${this.taskId} TYPE: ${this.type} Error:`,e),this.onError(e),this.emit("error",e),this.stop()}status(){return this._status}}t.AsyncTask=i;class o{static addTask(e){o.tasks.push(e),e.start(),e.on("stopped",(()=>o.onTaskStopped(e))),e.on("error",(()=>o.onTaskError(e)))}static onTaskStopped(e){a.default.info("Async Task:",e.taskId,"Stopped.")}static onTaskError(e){a.default.info("Async Task:",e.taskId,"Failed.")}static getTask(e,t){for(const n of o.tasks)if(n.taskId===e&&(null==t||n.type===t))return n}static getTasks(e){const t=[];for(const n of o.tasks)null!=e&&n.type!==e||t.push(n);return t}static deleteAllStoppedTask(){o.tasks.forEach(((e,t,n)=>{1!==e.status()&&n.splice(t,1)}))}}t.TaskCenter=o,o.tasks=new Array},6674:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createQuickInstallTask=t.QuickInstallTask=void 0;const r=n(5828),a=s(n(2167)),i=n(2781),o=s(n(4470)),c=s(n(5275)),u=s(n(9597)),l=s(n(8485)),d=n(3640),f=s(n(1017)),p=n(5925),h=n(6399);class m extends h.AsyncTask{constructor(e,t){super(),this.instanceName=e,this.targetLink=t,this.TMP_ZIP_NAME="mcsm_install_package.zip",this.ZIP_CONFIG_JSON="mcsmanager-config.json",this.zipPath="",this.downloadStream=null,this.JAVA_17_PATH=f.default.normalize(f.default.join(process.cwd(),"lib","jre17","bin","java.exe"));const n=new l.default;n.nickname=e,n.cwd=null,n.stopCommand="stop",n.type=c.default.TYPE_MINECRAFT_JAVA,this.instance=u.default.createInstance(n),this.taskId=`${m.TYPE}-${this.instance.instanceUuid}-${r.v4()}`,this.type=m.TYPE}download(){return new Promise((async(e,t)=>{try{this.zipPath=f.default.normalize(f.default.join(this.instance.config.cwd,this.TMP_ZIP_NAME));const n=o.default.createWriteStream(this.zipPath),s=await a.default({url:this.targetLink,responseType:"stream"});this.downloadStream=i.pipeline(s.data,n,(n=>{n?t(n):e(!0)}))}catch(e){t(e)}}))}hasJava17(){return o.default.existsSync(this.JAVA_17_PATH)}async onStarted(){const e=p.getFileManager(this.instance.instanceUuid);try{let t=await this.download();if(t=await e.promiseUnzip(this.TMP_ZIP_NAME,".","UTF-8"),!t)throw new Error(d.$t("quick_install.unzipError"));const n=JSON.parse(await e.readFile(this.ZIP_CONFIG_JSON));n.startCommand&&n.startCommand.includes("{{java}}")&&(this.hasJava17()?n.startCommand=n.startCommand.replace("{{java}}",this.JAVA_17_PATH):n.startCommand=n.startCommand.replace("{{java}}","java")),this.instance.parameters(n),this.stop()}catch(e){this.error(e)}finally{o.default.remove(e.toAbsolutePath(this.TMP_ZIP_NAME),(()=>{}))}}async onStopped(){try{this.downloadStream&&this.downloadStream.destroy(new Error("STOP TASK"))}catch(e){}}onError(){}toObject(){return JSON.parse(JSON.stringify({taskId:this.taskId,status:this.status(),instanceUuid:this.instance.instanceUuid,instanceStatus:this.instance.status(),instanceConfig:this.instance.config}))}}t.QuickInstallTask=m,m.TYPE="QuickInstallTask",t.createQuickInstallTask=function(e,t){if(!e||!t)throw new Error("targetLink or instanceName is null!");const n=new m(t,e);return h.TaskCenter.addTask(n),n}},3576:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DockerManager=void 0;const r=s(n(4856));class a{constructor(e){this.docker=null,this.docker=new r.default(e)}getDocker(){return this.docker}static setBuilderProgress(e,t){a.builderProgress.set(e,t)}static getBuilderProgress(e){return a.builderProgress.get(e)}async startBuildImage(e,t){try{a.setBuilderProgress(t,1);const n=await this.docker.buildImage({context:e,src:["Dockerfile"]},{t});await new Promise(((e,t)=>{this.docker.modem.followProgress(n,((n,s)=>n?t(n):e(s)))})),a.setBuilderProgress(t,2)}catch(e){a.setBuilderProgress(t,-1)}}}t.DockerManager=a,a.builderProgress=new Map},5925:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFileManager=void 0;const r=n(3640),a=s(n(9597)),i=s(n(7701));t.getFileManager=function(e){var t;const n=a.default.getInstance(e);if(!n)throw new Error(r.$t("file_router_service.instanceNotExit",{uuid:e}));const s=null===(t=n.config)||void 0===t?void 0:t.fileCode,o=n.config.cwd;return new i.default(o,s)}},9815:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initKoa=void 0;const r=s(n(1406)),a=s(n(5004)),i=s(n(1697));t.initKoa=function(){const e=new r.default;return e.use(a.default({multipart:!0,formidable:{maxFileSize:0xfa00000000}})),e.use((async(e,t)=>{await t(),e.response.set("Access-Control-Allow-Origin","*"),e.response.set("Access-Control-Allow-Methods","POST, GET, PUT, DELETE, OPTIONS"),e.response.set("Access-Control-Allow-Headers","Content-Type, Cookie, Accept-Encoding, User-Agent, Host, Referer, X-Requested-With, Accept, Accept-Language, Cache-Control, Connection"),e.response.set("X-Power-by","MCSManager")})),e.use(i.default.routes()).use(i.default.allowedMethods()),e}},559:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initDependent=void 0;const r=n(3640),a=s(n(2037)),i=s(n(4470)),o=s(n(5687)),c=s(n(1017)),u=s(n(3018)),l=`pty_${a.default.platform()}_${a.default.arch()}${"win32"===a.default.platform()?".exe":""}`,d=c.default.normalize(c.default.join(process.cwd(),"lib",l)),f=c.default.join(process.cwd(),"lib");t.initDependent=function(){const e=["https://mcsmanager.com/download/pty_windows_x64.exe",`https://mcsmanager.oss-cn-guangzhou.aliyuncs.com/${l}`];!function t(n=0){var s;(s=e[n],new Promise(((e,t)=>{var n;if(i.default.existsSync(f)||i.default.mkdirsSync(f),i.default.existsSync(d)&&(null===(n=i.default.statSync(d))||void 0===n?void 0:n.size)>1024)return u.default.info(r.$t("install.ptySupport")),e(1);const a=i.default.createWriteStream(d);o.default.get(s,(n=>{if(200!==n.statusCode)return t(new Error("code!=200"));n.on("error",(e=>{i.default.existsSync(d)&&i.default.removeSync(d),t(e)})),n.on("end",(()=>{a.end(),e(0)})),n.pipe(a)}))}))).then((()=>{u.default.info(r.$t("install.installed")),u.default.info(r.$t("install.guide")),i.default.chmod(d,511,(e=>{e&&u.default.warn(r.$t("install.changeModeErr",{path:d}))}))})).catch((s=>(i.default.remove(d,(()=>{})),n===e.length-1?(u.default.warn(r.$t("install.installErr")),void u.default.warn(s)):t(n+1))))}(0)}},3018:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(4470)),c=a(n(8094)),u=n(5103),l=n(3640),d="logs/current.log",f="logs/sysinfo.log",p=new Date,h=`${p.getFullYear()}-${p.getMonth()+1}-${p.getDate()}_${p.getHours()}-${p.getMinutes()}-${p.getSeconds()}`;o.default.existsSync(d)&&o.default.renameSync(d,`logs/${h}.log`),o.default.existsSync(f)&&o.default.renameSync(f,`logs/sysinfo_${h}.log`),c.configure({appenders:{out:{type:"stdout",layout:{type:"pattern",pattern:"[%d{MM/dd hh:mm:ss}] [%[%p%]] %m"}},app:{type:"file",filename:d,layout:{type:"pattern",pattern:"[%d{MM/dd hh:mm:ss}] [%p] %m"}},sys:{type:"file",filename:f,layout:{type:"pattern",pattern:"[%d{MM/dd hh:mm:ss}] [%p] %m"}}},categories:{default:{appenders:["out","app"],level:"info"},sysinfo:{appenders:["sys"],level:"info"}}});const m=c.getLogger("default"),g=c.getLogger("sysinfo");function _(e){return parseInt(String(e))}setInterval((function(){const e=1048576,t=u.systemInfo(),n=process.memoryUsage(),s=`MEM: ${_((t.totalmem-t.freemem)/e)}MB/${_(t.totalmem/e)}MB CPU: ${_(100*t.cpuUsage)}%`,r=`Heap: ${_(n.heapUsed/e)}MB/${_(n.heapTotal/e)}MB`,a=`RSS: ${_(n.rss/e)}MB`,i=l.$t("app.sysinfo");g.info([`[${i}]`,s,r,a].join(" "))}),5e3),t.default=m},5496:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.missionPassport=void 0;const n=new class{constructor(){this.missions=new Map,setInterval((()=>{const e=(new Date).getTime();this.missions.forEach(((t,n)=>{e>t.end&&this.missions.delete(n)}))}),1e3)}registerMission(e,t){if(this.missions.has(e))throw new Error("Duplicate primary key, failed to create task");this.missions.set(e,t)}getMission(e,t){if(!this.missions.has(e))return null;const n=this.missions.get(e);return n.name===t?n:null}deleteMission(e){this.missions.delete(e)}};t.missionPassport=n},8742:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.broadcast=t.socketObjects=t.delGlobalSocket=t.addGlobalSocket=t.stringify=t.parse=t.error=t.msg=t.responseError=t.response=t.Packet=void 0;const r=n(3640),a=s(n(2827)),i=s(n(3018)),o=n(5018),c=new Map;class u{constructor(e=null,t=200,n=null,s=null){this.uuid=e,this.status=t,this.event=n,this.data=s}}function l(e,t,n){const s=new u(e.uuid,200,t,n);e.socket.emit(t,s)}t.Packet=u,t.response=function(e,t){const n=new u(e.uuid,200,e.event,t);e.socket.emit(e.event,n)},t.responseError=function(e,t,n){let s="";s=t?t.toString():t;const a=new u(e.uuid,500,e.event,s);if(t.toString().includes(o.IGNORE))return e.socket.emit(e.event,a);(null==n?void 0:n.notPrintErr)||i.default.warn(r.$t("protocol.socketErr",{id:e.socket.id,address:e.socket.handshake.address,event:e.event}),t),e.socket.emit(e.event,a)},t.msg=l,t.error=function(e,t,n){const s=new u(e.uuid,500,t,n);if(n.toString().includes(o.IGNORE))return e.socket.emit(e.event,s);i.default.warn(r.$t("protocol.socketErr",{id:e.socket.id,address:e.socket.handshake.address,event:e.event}),n),e.socket.emit(t,s)},t.parse=function(e){if("object"==typeof e)return new u(e.uuid||null,e.status,e.event,e.data);const t=JSON.parse(e);return new u(null,t.status,t.event,t.data)},t.stringify=function(e){return JSON.stringify(e)},t.addGlobalSocket=function(e){c.set(e.id,e)},t.delGlobalSocket=function(e){c.delete(e.id)},t.socketObjects=function(){return c},t.broadcast=function(e,t){c.forEach((n=>{l(new a.default(null,n),e,t)}))}},1018:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.navigation=t.routerApp=void 0;const r=n(3640),a=n(1239),i=s(n(3018)),o=s(n(2827)),c=n(8742);class u extends a.EventEmitter{constructor(){super(),this.middlewares=[]}emitRouter(e,t,n){try{super.emit(e,t,n)}catch(e){c.responseError(t,e)}return this}on(e,t){return super.on(e,t)}use(e){this.middlewares.push(e)}getMiddlewares(){return this.middlewares}}t.routerApp=new u,t.navigation=function(e){const n={};for(const s of t.routerApp.getMiddlewares())e.use(((t,r)=>{const a=t[1];if(!a)return i.default.info(`session ${e.id} request data protocol format is incorrect`);const c=new o.default(a.uuid,e,n);s(t[0],c,a.data,r)}));for(const s of t.routerApp.eventNames())e.on(s,(r=>{if(!r)return i.default.info(`session ${e.id} request data protocol format is incorrect`);const a=new o.default(r.uuid,e,n,s.toString());t.routerApp.emitRouter(s,a,r.data)}));const s=new o.default(null,e,n);t.routerApp.emitRouter("connection",s,null)},n(7098),n(3360),n(6194),n(390),n(8709),n(2384),n(7264),n(7232),n(5995),i.default.info(r.$t("router.initComplete"))},7701:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(1017)),i=s(n(4470)),o=n(5046),c=s(n(5135)),u=n(8222),l=r.$t("system_file.illegalAccess");t.default=class{constructor(e="",t){this.topPath=e,this.fileCode=t,this.cwd=".",a.default.isAbsolute(e)?this.topPath=a.default.normalize(e):this.topPath=a.default.normalize(a.default.join(process.cwd(),e)),t||(this.fileCode="utf-8","zh_cn"==r.i18next.language&&(this.fileCode="gbk"))}toAbsolutePath(e=""){return a.default.normalize(a.default.join(this.topPath,this.cwd,e))}checkPath(e){const t=this.toAbsolutePath(e),n=this.topPath;return 0===t.indexOf(n)}check(e){return this.checkPath(e)&&i.default.existsSync(this.toAbsolutePath(e))}cd(e){if(!this.check(e))throw new Error(l);this.cwd=a.default.normalize(a.default.join(this.cwd,e))}list(e,t=40){if(t>100||t<=0||e<0)throw new Error("Beyond the value limit");const n=i.default.readdirSync(this.toAbsolutePath()),s=n.length,r=e*t,a=r+t,o=[],c=[];n.forEach((e=>{try{const t=i.default.statSync(this.toAbsolutePath(e));t.isFile()?o.push({name:e,type:1,size:t.size,time:t.atime.toString()}):c.push({name:e,type:0,size:t.size,time:t.atime.toString()})}catch(e){}})),o.sort(((e,t)=>e.name>t.name?1:-1)),c.sort(((e,t)=>e.name>t.name?1:-1));let u=c.concat(o);return u=u.slice(r,a),{items:u,page:e,pageSize:t,total:s}}async readFile(e){if(!this.check(e))throw new Error(l);const t=this.toAbsolutePath(e),n=await i.default.readFile(t);return c.default.decode(n,this.fileCode)}async writeFile(e,t){if(!this.check(e))throw new Error(l);const n=this.toAbsolutePath(e),s=c.default.encode(t,this.fileCode);return await i.default.writeFile(n,s)}async copy(e,t){if(!this.checkPath(t)||!this.check(e))throw new Error(l);const n=this.toAbsolutePath(e);return t=this.toAbsolutePath(t),await i.default.copy(n,t)}mkdir(e){if(!this.checkPath(e))throw new Error(l);const t=this.toAbsolutePath(e);return i.default.mkdirSync(t)}async delete(e){if(!this.check(e))throw new Error(l);const t=this.toAbsolutePath(e);return new Promise(((e,n)=>{i.default.remove(t,(t=>{t?n(t):e(!0)}))}))}async move(e,t){if(!this.check(e))throw new Error(l);if(!this.checkPath(t))throw new Error(l);const n=this.toAbsolutePath(e);t=this.toAbsolutePath(t),await i.default.move(n,t)}zipFileCheck(e){const t=i.default.statSync(e),n=u.globalConfiguration.config.maxZipFileSize;if(t.size>1073741824*n)throw new Error(r.$t("system_file.unzipLimit",{max:n}))}unzip(e,t,n){if(n||(n=this.fileCode),!this.check(e)||!this.checkPath(t))throw new Error(l);this.zipFileCheck(this.toAbsolutePath(e)),o.decompress(this.toAbsolutePath(e),this.toAbsolutePath(t),n).then((()=>{})).catch((()=>{}))}zip(e,t,n,s=((e,t)=>{})){var a;if(n||(n=this.fileCode),!this.checkPath(e))throw new Error(l);const c=u.globalConfiguration.config.maxZipFileSize,d=1073741824*c,f=this.toAbsolutePath(e),p=[];let h=0;for(const e of t)if(this.check(e)){p.push(this.toAbsolutePath(e));try{h+=null===(a=i.default.statSync(this.toAbsolutePath(e)))||void 0===a?void 0:a.size}catch(e){}}if(h>d)throw new Error(r.$t("system_file.unzipLimit",{max:c}));o.compress(f,p,n).then((e=>{s(null,e)})).catch((e=>{s(e)}))}async promiseUnzip(e,t,n){if(n||(n=this.fileCode),!this.check(e)||!this.checkPath(t))throw new Error(l);return this.zipFileCheck(this.toAbsolutePath(e)),await o.decompress(this.toAbsolutePath(e),this.toAbsolutePath(t),n)}async promiseZip(e,t,n){return new Promise(((s,r)=>{this.zip(e,t,n,((e,t)=>{if(e)return r(e);s(t)}))}))}async edit(e,t){if(!this.check(e))throw new Error(l);if(t)return await this.writeFile(e,t);{const t=this.toAbsolutePath(e);if(i.default.statSync(t).size>4194304)throw new Error(r.$t("system_file.execLimit"));return await this.readFile(e)}}rename(e,t){if(!this.check(e))throw new Error(l);if(!this.checkPath(t))throw new Error(l);const n=this.toAbsolutePath(e),s=this.toAbsolutePath(t);i.default.renameSync(n,s)}static checkFileName(e){const t=["/","\\","|","?","*",">","<",";",'"'];for(const n of t)if(e.includes(n))return!1;return!0}}},9597:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(4470)),i=s(n(1017)),o=s(n(5275)),c=s(n(1239)),u=s(n(223)),l=s(n(3018)),d=n(5828),f=s(n(2270)),p=s(n(8485)),h=s(n(2764)),m=n(3459),g=s(n(9659)),_=s(n(9945)),y=s(n(1155)),w=i.default.join(process.cwd(),"data/InstanceData");a.default.existsSync(w)||a.default.mkdirsSync(w);class k extends c.default{constructor(){super(),this.LOG_DIR="data/InstanceLog/",this.instances=new Map,this.instanceStream=new h.default}autoStart(){this.instances.forEach((e=>{e.config.eventTask.autoStart&&e.exec(new y.default).then((()=>{l.default.info(r.$t("system_instance.autoStart",{name:e.config.nickname,uuid:e.instanceUuid}))})).catch((t=>{l.default.error(r.$t("system_instance.autoStartErr",{name:e.config.nickname,uuid:e.instanceUuid,reason:t}))}))}))}loadInstances(){f.default.list("InstanceConfig").forEach((e=>{try{const t=f.default.load("InstanceConfig",p.default,e),n=new o.default(e,t);t.eventTask.ignore=!1,n.forceExec(new g.default).then((e=>{})).catch((e=>{})),this.addInstance(n)}catch(t){l.default.error(r.$t("system_instance.readInstanceFailed",{uuid:e,error:t.message})),l.default.error(r.$t("system_instance.checkConf",{uuid:e}))}})),this.autoStart()}createInstance(e){const t=d.v4().replace(/-/gim,""),n=new o.default(t,new p.default);return e.cwd&&"."!==e.cwd||(e.cwd=i.default.normalize(`${w}/${n.instanceUuid}`),a.default.existsSync(e.cwd)||a.default.mkdirsSync(e.cwd)),e.ie=e.oe=e.fileCode="utf8",n.parameters(e),n.forceExec(new g.default),this.addInstance(n),n}addInstance(e){if(null==e.instanceUuid)throw new Error(r.$t("system_instance.uuidEmpty"));if(this.instances.has(e.instanceUuid))throw new Error(`The application instance ${e.instanceUuid} already exists.`);this.instances.set(e.instanceUuid,e),e.on("data",((...t)=>{this.emit("data",e.instanceUuid,...t)})),e.on("exit",((...t)=>{this.emit("exit",{instanceUuid:e.instanceUuid,instanceName:e.config.nickname},...t)})),e.on("open",((...t)=>{this.emit("open",{instanceUuid:e.instanceUuid,instanceName:e.config.nickname},...t)})),e.on("failure",((...t)=>{this.emit("failure",{instanceUuid:e.instanceUuid,instanceName:e.config.nickname},...t)}))}removeInstance(e,t){const n=this.getInstance(e);if(n)return n.destroy(),this.instances.delete(e),f.default.delete("InstanceConfig",e),_.default.deleteInstanceAllTask(e),t&&a.default.remove(n.config.cwd,(e=>{})),!0;throw new Error("Instance does not exist")}forward(e,t){try{this.instanceStream.requestForward(t,e)}catch(e){}}stopForward(e,t){try{this.instanceStream.cannelForward(t,e)}catch(e){}}forEachForward(e,t){this.instanceStream.forwardViaCallback(e,(e=>{t(e)}))}getInstance(e){return this.instances.get(e)}getQueryMapWrapper(){return new m.QueryMapWrapper(this.instances)}exists(e){return this.instances.has(e)}async exit(){let e=[];for(const t of this.instances){const n=t[1];n.status()!=o.default.STATUS_STOP&&(l.default.info(`Instance ${n.config.nickname} (${n.instanceUuid}) is running or busy, and is being forced to end.`),e.push(n.execCommand(new u.default).then((()=>{f.default.store("InstanceConfig",n.instanceUuid,n.config),l.default.info(`Instance ${n.config.nickname} (${n.instanceUuid}) saved successfully.`)}))))}await Promise.all(e)}}t.default=new k},9945:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3640),a=s(n(7344)),i=s(n(9597)),o=s(n(2270)),c=s(n(3018)),u=s(n(1155)),l=s(n(3777)),d=s(n(5202)),f=s(n(7765)),p=s(n(223)),h=s(n(7701));class m{constructor(){this.instanceUuid="",this.name="",this.count=1,this.time="",this.action="",this.payload="",this.type=1}}class g{constructor(e,t){this.callback=e,this.time=t,this.job=0,this.job=setInterval(e,1e3*t)}cancel(){clearInterval(this.job)}}class _{constructor(e,t){this.config=e,this.job=t}}t.default=new class{constructor(){this.taskMap=new Map,this.taskJobMap=new Map,o.default.list("TaskConfig").forEach((e=>{const t=o.default.load("TaskConfig",m,e);try{this.registerScheduleJob(t,!1)}catch(e){}}))}registerScheduleJob(e,t=!0){var n;const s=`${e.instanceUuid}`;if(this.taskMap.has(s)||this.taskMap.set(s,[]),(null===(n=this.taskMap.get(s))||void 0===n?void 0:n.length)>=8)throw new Error(r.$t("system_instance_control.execLimit"));if(!this.checkTask(s,e.name))throw new Error(r.$t("system_instance_control.existRepeatTask"));if(!h.default.checkFileName(e.name))throw new Error(r.$t("system_instance_control.illegalName"));let i;if(t&&c.default.info(r.$t("system_instance_control.crateTask",{name:e.name,task:JSON.stringify(e)})),1===e.type){let t=Number(e.time);(isNaN(t)||t<1)&&(t=1),i=new g((()=>{this.action(e),-1!==e.count&&(1===e.count?(i.cancel(),this.deleteTask(s,e.name)):(e.count--,this.updateTaskConfig(s,e.name,e)))}),t)}else{const t=e.time.split(" ");[0,1,2].forEach((n=>{if(isNaN(Number(t[n]))&&Number(t[n])>=0)throw new Error(r.$t("system_instance_control.crateTaskErr",{name:e.name,timeArray:t}))})),i=a.default.scheduleJob(e.time,(()=>{this.action(e),-1!==e.count&&(1===e.count?(i.cancel(),this.deleteTask(s,e.name)):(e.count--,this.updateTaskConfig(s,e.name,e)))}))}const u=new _(e,i);this.taskMap.get(s).push(u),t&&o.default.store("TaskConfig",`${s}_${u.config.name}`,u.config),t&&c.default.info(r.$t("system_instance_control.crateSuccess",{name:e.name}))}listScheduleJob(e){const t=`${e}`,n=this.taskMap.get(t)||[],s=[];return n.forEach((e=>{s.push(e.config)})),s}async action(e){try{const t=e.payload,n=e.instanceUuid,s=i.default.getInstance(n);if(!s)return this.deleteScheduleTask(e.instanceUuid,e.name);const r=s.status();if("start"===e.action&&0===r)return await s.exec(new u.default("ScheduleJob"));if("stop"===e.action&&3===r)return await s.exec(new l.default);if("restart"===e.action&&3===r)return await s.exec(new f.default);if("command"===e.action&&3===r)return await s.exec(new d.default(t));if("kill"===e.action)return await s.exec(new p.default)}catch(t){c.default.error(r.$t("system_instance_control.execCmdErr",{uuid:e.instanceUuid,name:e.name,error:t}))}}deleteInstanceAllTask(e){const t=this.listScheduleJob(e);t&&t.forEach((t=>{this.deleteScheduleTask(e,t.name)}))}deleteScheduleTask(e,t){const n=`${e}`;this.deleteTask(n,t)}deleteTask(e,t){this.taskMap.get(e).forEach(((e,n,s)=>{e.config.name===t&&(e.job.cancel(),s.splice(n,1))})),o.default.delete("TaskConfig",`${e}_${t}`)}checkTask(e,t){let n=!0;return this.taskMap.get(e).forEach(((e,s,r)=>{e.config.name===t&&(n=!1)})),n}updateTaskConfig(e,t,n){const s=this.taskMap.get(e);for(const e in s)if(s[e].config.name===t){s[e].config=n;break}}checkScheduledTaskLimit(e){for(const e of this.taskMap);}}},4310:function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getVersion=t.initVersionManager=void 0;const o=n(3640),c=a(n(4470)),u=i(n(6473)),l=i(n(3018)),d="package.json";t.initVersionManager=function(){try{if(u.default.set("version","Unknown"),c.existsSync(d)){const e=JSON.parse(c.readFileSync(d,{encoding:"utf-8"}));e.version&&u.default.set("version",e.version)}}catch(e){l.default.error(o.$t("version.versionDetectErr"),e)}},t.getVersion=function(){return u.default.get("version","Unknown")}},1627:e=>{e.exports=require("@iarna/toml")},1511:e=>{e.exports=require("@koa/router")},5500:e=>{e.exports=require("archiver")},2167:e=>{e.exports=require("axios")},7416:e=>{e.exports=require("compressing")},4856:e=>{e.exports=require("dockerode")},1239:e=>{e.exports=require("events")},4470:e=>{e.exports=require("fs-extra")},8805:e=>{e.exports=require("i18next")},5135:e=>{e.exports=require("iconv-lite")},1406:e=>{e.exports=require("koa")},5004:e=>{e.exports=require("koa-body")},8094:e=>{e.exports=require("log4js")},7344:e=>{e.exports=require("node-schedule")},7601:e=>{e.exports=require("node-stream-zip")},7411:e=>{e.exports=require("os-utils")},3691:e=>{e.exports=require("pidusage")},8231:e=>{e.exports=require("properties")},3952:e=>{e.exports=require("socket.io")},5828:e=>{e.exports=require("uuid")},9066:e=>{e.exports=require("yaml")},2081:e=>{e.exports=require("child_process")},1891:e=>{e.exports=require("dgram")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},4521:e=>{e.exports=require("readline")},2781:e=>{e.exports=require("stream")},3674:e=>{e.exports=JSON.parse('{"app":{"welcome":"Welcome to the MCSManager daemon","instanceLoad":"Loaded {{n}} instances.","instanceLoadError":"Failed to load local instance file:","sessionConnect":"Session {{ip}} {{uuid}} connected","sessionDisconnect":"session {{ip}} {{uuid}} disconnected","started":"Daemon ","doc":"Documentation：https://docs.mcsmanager.com/","addr":"Access URL：http://<IP>:{{port}}/ or ws://<IP>:{{port}}","configPathTip":"Configuration file：data/Config/global.json","password":"Access token：{{key}}","passwordTip":"The access token served as the only access credential，please use the MCSManager WebPanel to connect.","exitTip":"Use Ctrl+C to close this program.","sysinfo":"SysInfo"},"common":{"title":"Title","_7zip":"[7zip compression task]","_7unzip":"[7zip decompression task]","killProcess":"Forced kill process {{pid}}","uuidIrregular":"Invalid UUID {{uuid}}."},"command":{"quotes":"Unpaired quotes，use {quotes} to bypass the limit.","errLen":"Incorrect command length, please double check your command format.","instanceNotOpen":"Failed to execute command, could not find the instance process."},"instance":{"dirEmpty":"start command, I/O encoding, or working directory is empty.","dirNoE":"The working directory does not exist.","invalidCpu":"Illegal CPU core specification {{v}}","invalidContainerName":"Invalid container name {{v}}","successful":"Instance {{v}} started successfully"},"start":{"instanceNotDown":"Could not start instance: already running.","instanceMaturity":"Could not start instance: instance expired.","startInstance":"starting instance..."},"restart":{"start":"Executing scheduled restart.","error1":"Error restarting instance: instance has already been restarted. Restart of last state cancelled.","error2":"Error restarting instance: incorrect instance status (expected: stopping, actual: running), restart cancelled.","restarting":"Detected an unexpected server stop, restarting..."},"general_start":{"instanceConfigErr":"Start command，I/O encoding, or working directory is empty.","cwdPathNotExist":"The working directory does not exist.","cmdEmpty":"Unable to start instance: empty start command.","startInstance":"Session {{source}}: Request to start instance.","instanceUuid":"Instance identifier: [{{uuid}}]","startCmd":"Start command: {{cmdList}}","cwd":"Working directory: {{cwd}}","pidErr":"Failed to start instance/container (empty PID)，Possible cause:\\n1. Incorrect start command，please double check the start command and parameters.\\n2. Incorrect configured host environment (e.g. no Java installed or PATH issue).\\n\\nNative start command：\\n{{startCommand}}\\n\\nStart command parsing body:\\nProgram：{{commandExeFile}}\\nParameter(s)：{{commandParameters}}\\n\\nPlease report to system administrator, consult with tenical specialist, or troubleshoo on your own.","startErr":"Failed to start instance: Please check the starting command, host environment, or configuration file.","startSuccess":"Instance {{instanceUuid}} started, PID: {{pid}}","startOrdinaryTerminal":"Instance running. You can use command at the input box located at the bottom. If you need to use function keys like CTRL or TAB, please enable the emulation mode  in terminal settings."},"general_stop":{"notRunning":"Failed to stop instance: not running.","execCmd":"Executed pre-defined stop command：{{stopCommand}}\\nPlease set the correct stop command in the instance settings if the instance are not stopping.","stopErr":"Failed to stop instance: stop command sent but the instance is not shutting down. Please double check your stop command or if instance is frozen. The status was reset to running. You can also force terminate the instance process."},"general_update":{"statusErr_notStop":"Unable to update: incorrect instance status, it has to be stopped first.","statusErr_otherProgress":"Incorrect instance status: other task(s) running.","readyUpdate":"Instance {{instanceUuid}} is preparing an update...","updateCmd":"Instance {{instanceUuid}} execute the following update command(s):","cmdFormatErr":"pdate command format error, please contact system administrator","err":"Error","updateFailed":"Update failed: the update command failed to start, please contact system administrator.","update":"Update","updateSuccess":"Successfully updated！","updateErr":"Update finished with incorrect result. Possibly due to damaged file(s) or network status.","error":"Update error: {{err}}","terminateUpdate":"User request to stop the async update task for instance: {{instanceUuid}}","killProcess":"Killing task process..."},"pty_start":{"cmdErr":"Start command，I/O encoding, or working directory is empty.","cwdNotExist":"The working directory does not exist.","startPty":"Session {{source}}: request to start instance in emulation terminal.","startErr":"Failed to start emulation terminal: Lack of dependencies. Fall back to general terminal.","notSupportPty":"Failed to start emulation terminal: Unsupported system or architecture. Fall back to general terminal.","cmdEmpty":"Unable to start instance，empty startup command.","sourceRequest":"Session {{source}}: request to start instance.","instanceUuid":"Instance Identifier: [{{instanceUuid}}]","startCmd":"Start command: {{cmd}}","ptyPath":"PTY Path: {{path}}","ptyParams":"PTY parameter: {{param}}","ptyCwd":"Working directory: {{cwd}}","pidErr":"Failed to start instance/container (empty PID)，Possible cause:\\n1. Incorrect start command，please double check the start command and parameters.\\n2. Incorrect configured host environment (e.g. no Java installed or PATH issue).\\n\\nNative start command：\\n{{startCommand}}\\n\\nEmulation terminal tranPlease report to system administrator, consult with tenical specialist, or troubleshoo on your own.\\nIf you think this is a panel issue, please switch back to general terminal mode by disabling the emulation mode.","instanceStartErr":"Failed to start instance: Please check the starting command, host environment, or configuration file.","startSuccess":"Instance {{instanceUuid}} Successfullly started PID: {{pid}}","startEmulatedTerminal":"Active emulation terminal, you can use function keys (like CTRL, TAB) directly.","mustAbsolutePath":"In order to use the emulation terminal, you must use absolute path for your instance."},"pty_stop":{"notRunning":"Failed to stop: not running.","execCmd":"Executed pre-defined stop command：{{stopCommand}}\\nPlease set the correct stop command in the instance settings if the instance are not stopping.","stopErr":"Failed to stop instance: stop command sent but the instance is not shutting down. Please double check your stop command or if instance is frozen. The status was reset to running. You can also force terminate the instance process."},"instanceConf":{"initInstanceErr":"Failed to initialize instance: empty identifier or configuration.","cantModifyInstanceType":"Unable change instance type: instance running.","cantModifyProcessType":"Unable to change instance process type: instance running.","cantModifyPtyModel":"Unable to change PTY mode: instance running.","ptyNotExist":"Unable to use emulation terminal: {{path}}  dependencies not exist. Youcan contact system administrator to install it by restarting the Daemon under Linux environment.","instanceLock":"Failed to execute operation {{info}} : instance locked, please try again later.","instanceBusy":"Instance busy, unable to perform any actions.","info":"Info","error":"Error","autoRestart":"Unexpected stop detected, restarting...","autoRestartErr":"Failed to auto restart: {{err}}","instantExit":"Instance exited short after started, might be due to a wrong start command or configuration."},"preset":{"actionErr":"Pre-defined command {{action}} unavailable."},"process_config":{"writEmpty":"Empty write content: might be due to unsupported file type."},"mc_update":{"updateInstance":"Update instance....."},"auth_router":{"notAccess":"Blocked an un authorized access from session {{id}}({{address}}) to {{event}}.","illegalAccess":"Insufficient permission, illegal access.","access":"Session {{id}}({{address}}) authenticated.","disconnect":"Session {{id}}({{address}}) disconnected due to authentication timed out."},"environment_router":{"dockerInfoErr":"Unable to get image information, please make sure docker was correctly installed.","crateImage":"Daemon is creating image {{name}}:{{tag}} DockerFile as:\\n{{dockerFileText}}\\n","crateSuccess":"Image creation {{name}}:{{tag}} success","crateErr":"Image creation {{name}}:{{tag}} error:{{error}}","delImage":"Daemon is deleting image {{imageId}}"},"file_router":{"instanceNotExist":"Instance {{instanceUuid}} does not exist.","unzipLimit":"Exceeded the maximum allowed decompresson tasks. Limit: {{maxFileTask}}，currently running: {{fileLock}}. Please wait patiently."},"http_router":{"instanceNotExist":"Instance doesn\'t exist.","fileNameNotSpec":"File requested by user does not conform to hte specification.","downloadErr":"Download error: {{error}}","updateErr":"Unkonwn reason: Upload error"},"Instance_router":{"requestIO":"Session {{id}} Request to redirect I/O stream of instance {{targetInstanceUuid}}","cancelIO":"Session {{id}} Request to stop redirect I/O stream of instance {{targetInstanceUuid}}","openInstanceErr":"Error starting instance {{instanceUuid}} : ","performTasks":"Session {{id}} asks instance {{uuid}} to execute async task:  {{taskName}}","performTasksErr":"instance {{uuid}} reported an error while executing async task {{taskName}} error: {{err}}","taskEmpty":"No async task running","accessFileErr":"Access denied due to path error or non-existent file.","terminalLogNotExist":"terminal log file does not exist."},"passport_router":{"registerErr":"Invalid task name or empty token."},"stream_router":{"unauthorizedAccess":"Insufficient perission, Illegal access.","taskNotExist":"Task not exist.","instanceNotExist":"Instance does not exist.","authSuccess":"Session {{id}} {{address}} I/O channel authenticated.","establishConnection":"Established data channel between session {{id}} {{address}} and {{uuid}}","disconnect":"Session {{id}} {{address}} disconnected from {{uuid}}","IGNOREAccess":"illegal access"},"file_router_service":{"instanceNotExit":"Instance {{uuid}} does not exist."},"install":{"ptyNotSupportSystem":"Emulation terminal can only support Windows/Linux x86_64 architecture, fall back to general terminal.","ptySupport":"Found installed dependencies, emulation terminal is available now.","skipInstall":"Non-Linux environment, skipping dependencies installation.","installed":"Optional depencies installed, emulation terminal and some advanced features are now available.","guide":"Dependency reference: https://github.com/mcsmanager/pty","changeModeErr":"Failed to change permission of {{path}} .Please set it to chmod 755 or above manually.","installErr":"Dependencies installation failed. Emulation terminal and some advancced features are not available. The installation task will be retried on next start."},"protocol":{"socketErr":"Invalid response from session {{id}}({{address}})/{{event}} :\\n"},"router":{"initComplete":"Initialization complete."},"system_file":{"illegalAccess":"Illegal access directory.","unzipLimit":"File decompression only support file size up to {{max}}GB . You can change this limit in data/Config/global.json","execLimit":"Exceeded the maximum file edit size limit."},"system_instance_control":{"execLimit":"Unable to create scheduled task: limit reached.","existRepeatTask":"A duplicate task already exists","illegalName":"Illegal task name. Only underscore, digit, and letters are supported.","crateTask":"Create scheduled task {{name}}:\\n{{task}}","crateTaskErr":"Error on creating scheduled task: incorrect time expression: \\n{{name}}: {{timeArray}}\\nPlease try remove file data/TaskConfig/{{name}}.json","crateSuccess":"Successfully created schedule task: {{name}}","execCmdErr":"Error on executing scheduled task {{name}} for instance {{uuid}}. Error: \\n {{error}}"},"system_instance":{"autoStart":"Sent an auto start command to instance {{name}} {{uuid}} ","autoStartErr":"Error while auto starting instance: {{name}} {{uuid}} Reason: {{reason}}","readInstanceFailed":"Failed to read application instance {{uuid}} Error: {{error}}","checkConf":"Please verify or delete file：data/InstanceConfig/{{uuid}}.json","uuidEmpty":"Unable to create new instance: empty UUID."},"ui":{"help":"[Terminal] MCSManager Daemon is able to perform operations. Use \\"help\\" for more information."},"version":{"versionDetectErr":"Version check failed."},"quick_install":{"unzipError":"Failed decompress file.","hiperError":"Unable to start another HiPer process: HiPer is running.！"},"hiper":{"alreadyExist":"Unable to start multiple HiPer process: HiPer is running."}}')},7169:e=>{e.exports=JSON.parse('{"app":{"welcome":"欢迎使用 MCSManager 守护进程","instanceLoad":"所有应用实例已加载，总计 {{n}} 个","instanceLoadError":"读取本地实例文件失败:","sessionConnect":"会话 {{ip}} {{uuid}} 已连接","sessionDisconnect":"会话 {{ip}} {{uuid}} 已断开","started":"守护进程现已成功启动","doc":"参考文档：https://docs.mcsmanager.com/","addr":"访问地址：http://<IP地址>:{{port}}/ 或 ws://<IP地址>:{{port}}","configPathTip":"配置文件：data/Config/global.json","password":"访问密钥：{{key}}","passwordTip":"密钥作为唯一认证方式，请使用 MCSManager 面板的节点功能连接程序","exitTip":"你可以使用 Ctrl+C 快捷键即可关闭程序","sysinfo":"资源报告"},"common":{"title":"标题","_7zip":"[7zip 压缩任务]","_7unzip":"[7zip 解压任务]","killProcess":"进程 {{pid}} 已使用系统指令强制终止进程","uuidIrregular":"UUID {{uuid}} 不符合规范"},"command":{"quotes":"错误的命令双引号，无法找到成对双引号，如需使用单个双引号请使用 {quotes} 符号","errLen":"错误的命令长度，请确保命令格式正确","instanceNotOpen":"命令执行失败，因为实例实际进程不存在"},"instance":{"dirEmpty":"启动命令，输入输出编码或工作目录为空值","dirNoE":"工作目录并不存在","invalidCpu":"非法的CPU核心指定 {{v}}","invalidContainerName":"非法的容器名 {{v}}","successful":"实例 {{v}} 启动成功"},"start":{"instanceNotDown":"实例未处于关闭状态，无法再进行启动","instanceMaturity":"实例使用到期时间已到，无法再启动实例","startInstance":"正在准备启动实例..."},"restart":{"start":"重启实例计划开始执行","error1":"重启实例状态错误，实例已被启动过，上次状态的重启计划取消","error2":"重启实例状态错误，实例状态应该为停止中状态，现在变为正在运行，重启计划取消","restarting":"检测到服务器已停止，正在重启实例..."},"general_start":{"instanceConfigErr":"启动命令，输入输出编码或工作目录为空值","cwdPathNotExist":"工作目录并不存在","cmdEmpty":"无法启动实例，启动命令为空","startInstance":"会话 {{source}}: 请求开启实例.","instanceUuid":"实例标识符: [{{uuid}}]","startCmd":"启动命令: {{cmdList}}","cwd":"工作目录: {{cwd}}","pidErr":"检测到实例进程/容器启动失败（PID 为空），其可能的原因是：\\n1. 实例启动命令编写错误，请前往实例设置界面检查启动命令与参数。\\n2. 系统主机环境不正确或缺少环境，如 Java 环境等。\\n\\n原生启动命令：\\n{{startCommand}}\\n\\n启动命令解析体:\\n程序：{{commandExeFile}}\\n参数：{{commandParameters}}\\n\\n请将此信息报告给管理员，技术人员或自行排查故障。","startErr":"实例启动失败，请检查启动命令，主机环境和配置文件等","startSuccess":"实例 {{instanceUuid}} 成功启动 PID: {{pid}}","startOrdinaryTerminal":"应用实例已运行，您可以在底部的命令输入框发送命令，如果您需要支持 Ctrl，Tab 等快捷键等高级控制台功能，请前往终端设置开启仿真终端功能"},"general_stop":{"notRunning":"实例未处于运行中状态，无法进行停止.","execCmd":"已执行预设的关闭命令：{{stopCommand}}\\n如果无法关闭实例请前往实例设置更改关闭实例的正确命令，比如 ^C，stop，end 等","stopErr":"关闭命令已发出但长时间未能关闭实例，可能是实例关闭命令错误或实例进程假死导致，现在将恢复到运行中状态，可使用强制终止指令结束进程。"},"general_update":{"statusErr_notStop":"实例状态不正确，无法执行更新任务，必须停止实例","statusErr_otherProgress":"实例状态不正确，有其他任务正在运行中","readyUpdate":"实例 {{instanceUuid}} 正在准备进行更新操作...","updateCmd":"实例 {{instanceUuid}} 执行更新命令如下:","cmdFormatErr":"更新命令格式错误，请联系管理员","err":"Error","updateFailed":"更新失败，更新命令启动失败，请联系管理员","update":"更新","updateSuccess":"更新成功！","updateErr":"更新程序结束，但结果不正确，可能文件更新损坏或网络不畅通","error":"更新错误: {{err}}","terminateUpdate":"用户请求终止实例 {{instanceUuid}} 的 update 异步任务","killProcess":"正在强制杀死任务进程..."},"pty_start":{"cmdErr":"启动命令，输入输出编码或工作目录为空值","cwdNotExist":"工作目录并不存在","startPty":"会话 {{source}}: 请求开启实例，模式为仿真终端","startErr":"仿真终端模式失败，可能是依赖程序不存在，已自动降级到普通终端模式...","notSupportPty":"仿真终端模式失败，无法支持的架构或系统，已自动降级到普通终端模式...","cmdEmpty":"无法启动实例，启动命令为空","sourceRequest":"会话 {{source}}: 请求开启实例.","instanceUuid":"实例标识符: [{{instanceUuid}}]","startCmd":"启动命令: {{cmd}}","ptyPath":"PTY 路径: {{path}}","ptyParams":"PTY 参数: {{param}}","ptyCwd":"工作目录: {{cwd}}","pidErr":"检测到实例进程/容器启动失败（PID 为空），其可能的原因是：\\n1. 实例启动命令编写错误，请前往实例设置界面检查启动命令与参数。\\n2. 系统主机环境不正确或缺少环境，如 Java 环境等。\\n\\n原生启动命令：\\n{{startCommand}}\\n\\n仿真终端中转命令:\\n程序：{{path}}\\n参数：{{params}}\\n\\n请将此信息报告给管理员，技术人员或自行排查故障。\\n如果您认为是面板仿真终端导致的问题，请在左侧终端设置中关闭“仿真终端”选项，我们将会采用原始输入输出流的方式监听程序。","instanceStartErr":"实例启动失败，请检查启动命令，主机环境和配置文件等","startSuccess":"实例 {{instanceUuid}} 成功启动 PID: {{pid}}","startEmulatedTerminal":"仿真终端模式已生效，您可以直接在终端内直接输入内容并使用 Ctrl，Tab 等功能键","mustAbsolutePath":"仿真终端启动工作目录必须使用绝对路径，请前往实例设置界面重新设置工作路径为绝对路径"},"pty_stop":{"notRunning":"实例未处于运行中状态，无法进行停止.","execCmd":"已执行预设的关闭命令：{{stopCommand}}\\n如果无法关闭实例请前往实例设置更改关闭实例的正确命令，比如 exit，stop，end 等","stopErr":"关闭命令已发出但长时间未能关闭实例，可能是实例关闭命令错误或实例进程假死导致，现在将恢复到运行中状态，可使用强制终止指令结束进程。"},"instanceConf":{"initInstanceErr":"初始化实例失败，唯一标识符或配置参数为空","cantModifyInstanceType":"正在运行时无法修改此实例类型","cantModifyProcessType":"正在运行时无法修改此实例进程类型","cantModifyPtyModel":"正在运行时无法修改PTY模式","ptyNotExist":"无法启用仿真终端，因为 {{path}} 附属程序不存在，您可以联系管理员重启 Daemon 程序得以重新安装（仅 Linux）","instanceLock":"此 {{info}} 操作无法执行，因为实例处于锁定状态，请稍后再试.","instanceBusy":"当前实例正处于忙碌状态，无法执行任何操作.","info":"信息","error":"错误","autoRestart":"检测到实例关闭，根据主动事件机制，自动重启指令已发出...","autoRestartErr":"自动重启错误: {{err}}","instantExit":"检测到实例启动后在极短的时间内退出，原因可能是您的启动命令错误或配置文件错误。"},"preset":{"actionErr":"预设命令 {{action}} 不可用"},"process_config":{"writEmpty":"写入内容为空，可能是配置文件类型不支持"},"mc_update":{"updateInstance":"更新实例....."},"auth_router":{"notAccess":"会话 {{id}}({{address}}) 试图无权限访问 {{event}} 现已阻止.","illegalAccess":"非法访问","access":"会话 {{id}}({{address}}) 验证身份成功","disconnect":"会话 {{id}}({{address}}) 因长时间未验证身份而断开连接"},"environment_router":{"dockerInfoErr":"无法获取镜像信息，请确保您已正确安装Docker环境","crateImage":"守护进程正在创建镜像 {{name}}:{{tag}} DockerFile 如下:\\n{{dockerFileText}}\\n","crateSuccess":"创建镜像 {{name}}:{{tag}} 完毕","crateErr":"创建镜像 {{name}}:{{tag}} 错误:{{error}}","delImage":"守护进程正在删除镜像 {{imageId}}"},"file_router":{"instanceNotExist":"实例 {{instanceUuid}} 不存在","unzipLimit":"超出最大同时解压缩任务量，最大准许{{maxFileTask}}个，目前有{{fileLock}}个任务正在进行，请耐心等待"},"http_router":{"instanceNotExist":"实例不存在","fileNameNotSpec":"用户文件下载名不符合规范","downloadErr":"下载出错: {{error}}","updateErr":"未知原因: 上传失败"},"Instance_router":{"requestIO":"会话 {{id}} 请求转发实例 {{targetInstanceUuid}} IO 流","cancelIO":"会话 {{id}} 请求取消转发实例 {{targetInstanceUuid}} IO 流","openInstanceErr":"实例{{instanceUuid}}启动时错误: ","performTasks":"会话 {{id}} 要求实例 {{uuid}} 执行异步 {{taskName}} 异步任务","performTasksErr":"实例 {{uuid}} {{taskName}} 异步任务执行异常: {{err}}","taskEmpty":"无异步任务正在运行","accessFileErr":"文件不存在或路径错误，文件访问被拒绝","terminalLogNotExist":"终端日志文件不存在"},"passport_router":{"registerErr":"不可定义任务名或密钥为空"},"stream_router":{"IGNOREAccess":"非法访问","taskNotExist":"任务不存在","instanceNotExist":"实例不存在","authSuccess":"会话 {{id}} {{address}} 数据流通道身份验证成功","establishConnection":"会话 {{id}} {{address}} 已与 {{uuid}} 建立数据通道","disconnect":"会话 {{id}} {{address}} 已与 {{uuid}} 断开数据通道","unauthorizedAccess":"非法访问"},"file_router_service":{"instanceNotExit":"实例 {{uuid}} 不存在"},"install":{"ptyNotSupportSystem":"仿真终端只能支持 Windows/Linux x86_64 架构，已自动降级为普通终端","ptySupport":"识别到可选依赖库安装，仿真终端功能已可用","skipInstall":"检测到系统不是 Linux 系统，自动跳过依赖库安装","installed":"可选依赖程序已自动安装，仿真终端和部分高级功能已自动启用","guide":"依赖程序参考：https://github.com/mcsmanager/pty","changeModeErr":"修改文件 {{path}} 权限失败，请手动设置其为 chmod 755 以上","installErr":"安装可选依赖库失败，全仿真终端和部分可选功能将无法使用，不影响正常功能，将在下次启动时再尝试安装"},"protocol":{"socketErr":"会话 {{id}}({{address}})/{{event}} 响应数据时异常:\\n"},"router":{"initComplete":"所有功能模块与权限防火墙已初始化完毕"},"system_file":{"illegalAccess":"非法访问路径","unzipLimit":"文件解压缩只支持最大 {{max}}GB 文件的解压缩，如需改变上限请前往 data/Config/global.json 文件","execLimit":"超出最大文件编辑限制"},"system_instance_control":{"execLimit":"无法继续创建计划任务，以达到上限","existRepeatTask":"已存在重复的任务","illegalName":"非法的计划名，仅支持下划线，数字，字母和部分本地语言","crateTask":"创建计划任务 {{name}}:\\n{{task}}","crateTaskErr":"计划任务创建错误，不正确的时间表达式: \\n{{name}}: {{timeArray}}\\n请尝试删除 data/TaskConfig/{{name}}.json 文件解决此问题","crateSuccess":"创建计划任务 {{name}} 完毕","execCmdErr":"实例 {{uuid}} 计划任务 {{name}} 执行错误: \\n {{error}}"},"system_instance":{"autoStart":"实例 {{name}} {{uuid}} 自动启动指令已发出","autoStartErr":"实例 {{name}} {{uuid}} 自动启动时错误: {{reason}}","readInstanceFailed":"读取 {{uuid}} 应用实例失败: {{error}}","checkConf":"请检查或删除文件：data/InstanceConfig/{{uuid}}.json","uuidEmpty":"无法新增某实例，因为实例UUID为空"},"ui":{"help":"[终端] 守护进程拥有基本的交互功能，请输入\\"help\\"查看更多信息"},"version":{"versionDetectErr":"版本检查失败"},"quick_install":{"unzipError":"解压文件失败","hiperError":"HiPer 进程已存在，不可重复启动！"},"hiper":{"alreadyExist":"HiPer 已经启动，无法运行多个"}}')}},t={};!function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}(3165)})();